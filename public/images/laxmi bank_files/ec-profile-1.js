!function(a,b,c,d){"use strict";c.module("esewaProfileApp",["restangular","ngStorage","esewaMessages","esewaSharedApp","ui.router"]).run(["$rootScope","$state","$localStorage","$http","$timeout","$sce","$location","$templateCache",function(a,b,c,d,e,f,g,h){}]),c.module("esewaProfileApp").controller("ChangePasswordCtrl",["$scope","$rootScope","$state","AuthService","$timeout","InformationService","INFORMATION","$sce","StateConstant","AUTH_EVENTS","ecmsg","MessageConstant",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){this.oldPassword="",this.newPassword=""}function n(){b.informationKey=o,b.$broadcast(j.information)}a.showloadingBar=!1;var o=g.userChangePassword;b.showInformation=!0,b.clearMessage(),a.password=new m,a.initChangePassword=function(){a.passwordDto=new m},a.checkNewPassword=function(){return a.passwordDto.newPassword!==a.passwordDto.confirmNewPassword},a.isNewPasswordAndOldPasswordSame=function(){return a.passwordDto.oldPassword===a.passwordDto.newPassword},a.cancelChangePassword=function(){a.passwordDto=null,c.go(i.HOME_MAIN)},a.changePassword=function(c){a.showloadingBar=!0,d.changePassword(c).then(function(c){a.success=c.plain(),e(function(){b.successMessageForIndex=!0,b.redirectMsg=a.success.message},500),delete b.$storage.changePassword,$modal.open({templateUrl:"/user/static/views/messageView.html",controller:p,size:"signUp",backdrop:"static",keyboard:!1})},function(c){a.showloadingBar=!1,c.data?b.message.error=c.data.error_message:b.message.error=l.serviceNotAvailable})};var p=["$scope","$rootScope","$modalInstance",function(a,b,c){b.currentModal=c,a.done=function(){b.logout()}}];n(),a.cancel=function(){c.go(i.HOME_MAIN)}}]),c.module("esewaProfileApp").controller("HomeController",["$rootScope","$scope",function(a,b){a.clearMessage(),a.$$phase||a.$apply(function(){a.showMostUsedServices=!0,a.showAddServices=!0})}]),c.module("esewaProfileApp").controller("InitialRequirementController",["$scope","$rootScope","$modal","$state","$window","AUTH_EVENTS","PropertyConstant","StateConstant",function(a,b,c,d,e,f,g,h){a.initialRequirement=b.initialRequirement,a.initialRequirement&&(a.openConfirmPersonalDetailDialog=function(a){c.open({templateUrl:"/user/authentication/views/initial_requirement_popup.html",controller:i,size:"lg",backdrop:"static",keyboard:!1,resolve:{initialRequirement:function(){return a}}})});var i=["$rootScope","$scope","initialRequirement","$state","$modalInstance","AUTH_EVENTS","CDNUrl","StateConstant",function(a,b,c,d,e,f,h,i){b.htmlLinkForInitialRequirement=c.url,a.showWelcomePage?(b.forceful=!1,a.showWelcomePage=!1,b.htmlLinkForInitialRequirement=h.welcomeForm):c.type===g.initialForceful&&(b.forceful=c.type),b.cancel=function(){c.type!==g.initialForceful&&(delete a.$storage.initialRequirement,d.go(i.HOME_MAIN),e.dismiss()),a.$broadcast(f.initialRequirement)},a.currentModal=e}];a.initialRequirement&&a.initialRequirement.url?a.openConfirmPersonalDetailDialog(a.initialRequirement):d.go(h.HOME_MAIN)}]),c.module("esewaProfileApp").controller("MpinController",["$state","$rootScope","$scope","MpinService","$modal","ecmsg","InformationService","INFORMATION","$sce","$timeout","StateConstant",function(a,b,d,e,f,g,h,i,j,k,l){function m(){n.old_mpin="",n.new_mpin=""}var n=this;c.isDefined(b.$storage.profile)&&(b.$storage.profile.is_primary||a.go(l.HOME_MAIN)),n.showInformation=!1,b.clearMessage(),n.MPIN=new m,n.initChangePassword=function(){n.MPIN=new m},n.checkNewMPIN=function(){return n.MPIN.new_mpin!==n.confirm_new_mpin},n.isNewPasswordAndOldMPINSame=function(){return n.MPIN.old_mpin===n.MPIN.new_mpin},n.cancelChangeMPIN=function(){n.MPIN=null,n.confirm_new_mpin=null,a.go(l.HOME_MAIN)},n.changeMPIN=function(d){e.changeMPIN(d).then(function(b){console.log(b.plain()),n.MPIN=null,n.confirm_new_mpin=null,k(function(){b.message&&(g.success=b.message)},500),a.go(l.HOME_MAIN)},function(a){b.showInformation=!1,c.isDefined(a)&&(a.data.error_message?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later to change your MPIN.")})},n.resetMpin=function(d){e.changeMPIN(d).then(function(){n.MPIN=null,n.confirm_new_mpin=null,a.go(l.HOME_MAIN),b.message="Your MPIN is now reset."},function(a){c.isDefined(a.data.error_message)?b.message=a.data.error_message:b.error="Failed to change MPIN Check your correct MPIN and try again!!!!"})},n.resetMpinForUser=function(a){d.resetAvailable=!0,b.$storage.initialRequirement&&"FORCEFUL"===b.$storage.initialRequirement.type&&(d.resetAvailable=!1),d.resetAvailable&&f.open({templateUrl:"user/authentication/views/rest_mpin.html",controller:o,size:"md",resolve:{esewaId:function(){return a}}})};var o=["$modalInstance","$state","$scope","$rootScope","esewaId",function(a,b,d,f,g){d.close=function(){a.dismiss()},f.currentModal=a,d.resetMpin=function(){e.resetMPIN(g).then(function(a){d.response=a.plain(),n.MPIN=null,n.confirm_new_mpin=null,d.response&&k(function(){f.successMessageForIndex=!0,f.showInformation=!1,f.message.success=d.response.message},100),d.close()},function(a){f.showInformation=!1,c.isDefined(a)&&(a.data.error_message?f.message.error=a.data.error_message:f.message.error="Service is currently unavailable. please, try again later to change your MPIN.")})},d.cancelChangeMPIN=function(){d.close()}}]}]),c.module("esewaProfileApp").service("AuthService",["Restangular",function(a){var b=a.all("auth"),c=a.all("esewa");this.authenticate=function(b){return a.one("authenticate").customPOST("","","",{esewa_id:b.esewaId,password:b.password})},this.registerUserUsingEsewaId=function(a,b){var d={esewa_id:a.esewaId,email:a.email,"g-recaptcha-response":b,terms_and_conditions:a.termsAndCondition};return c.all("reg").post(d)},this.validateToken=function(a){return c.one(a.esewaId+"").one("token").one(a.token+"").one("validate").customGET()},this.validateLastToken=function(a){return c.one(a.esewaId+"").one("token").one(a.token+"").one("validate").customGET()},this.changePassword=function(a){return b.one("change_password").customPUT("","","",{old_password:a.oldPassword,new_password:a.newPassword})},this.setPassword=function(a){var b={token:a.token};return c.one(a.esewaId+"").one("create_password").customPOST(b,"","",{password:a.password})},this.getInitialRequirements=function(){return b.one("initial_requirements").get()},this.getUserProfile=function(){return b.one("profile").customGET()},this.logout=function(b){return a.all("logout").customPOST("","","",{esewa_id:b})}}]),c.module("esewaProfileApp").service("MpinService",["Restangular",function(a){var b=a.all("auth");this.resetMPIN=function(a){return b.one(a).all("reset_mpin").customPUT()}}]),c.module("esewaProfileApp").service("BalanceService",["Restangular",function(a){var b=a.all("auth");this.getBalance=function(){return b.one("balance").get()}}]),c.module("esewaProfileApp").service("RewardService",["Restangular",function(a){var b=a.all("auth");this.getRewardPoints=function(){return b.one("reward_point").get()}}]),c.module("esewaProfileApp").controller("CredentialsController",["$scope","$rootScope","$state","$timeout","MpinService","ecmsg","SecUserService","$modal","AUTH_EVENTS","INFORMATION","$sce","RegexConstant","ActivationService","PropertyConstant",function(a,b,d,e,f,g,h,i,j,k,l,m,n,o){a.loginCredential={token:""},b.message.success="",a.showTokenBox=!1,a.disableSubmit=!1,a.initialRequirementForm=b.initialRequirement.form,a.initialRequirementType=b.initialRequirement.type,a.getCredentials=function(){a.disableSubmit=!1,a.showloadingBar=!0,h.getSecondaryUsers().then(function(b){a.showloadingBar=!1,e(function(){a.$$phase||a.$apply(function(){a.users=b.plain()})},100)},function(){a.showloadingBar=!1})},a.showAddCredentialForm=!1,a.showAddCredentialBlock=!1,a.showSetPassword=!1,a.getCredentials(),b.clearMessage(),b.message.error="",b.showloadingBar=!1,a.clearData=function(){a.passwordDto={newPassword:"",confirmNewPassword:""},a.credential={esewaId:""},a.userInfo={token:"",esewaId:""}},a.clearData(),e(function(){"MOBILE_NUMBER"===a.initialRequirementForm&&(a.showAddUsers=!0,a.showAddCredentialForm=!0,a.showAddCredentialBlock=!0,a.initialRequirementType===o.initialForceful&&(a.mandatory=!0))},500),a.addSecondaryUser=function(){a.clearData(),a.showAddCredentialForm=!0,a.showAddCredentialBlock=!0,a.showSetPassword=!1,a.showValidateUser=!1,a.credential={}},a.cancelTokenValidation=function(){a.showAddUsers=!1};var p=k.secondaryRegistration;b.showInformation=!1,a.getInformationMessage=function(){b.informationKey=p,b.$broadcast(j.information)},a.typeOfMobile=function(a){return m.mobileNo.test(a)},a.resendToken=function(a){a&&n.resendNotification(o.user,a).then(function(a){a&&a.data?b.message.success=a.data.message:b.message.success="Notification resent successfully"},function(){b.message.error="Service is currently unavailable. please, try again later."})},a.addSecondaryCredentials=function(d){a.showTokenBox=!0,b.message.success="",b.message.error="",a.esewaId=d.esewaId,a.validateMessage=!1,h.addSecondaryUser(d).then(function(f){a.secondaryUserResponse=f.plain(),a.typeOfMobile(d.esewaId)?(a.showAddCredentialBlock=!1,a.showValidateUser=!0,p=k.secondaryRegistrationToken,a.getCredentials(),e(function(){b.message.error="",b.message.success="",a.getInformationMessage()},300)):(a.showSetPassword=!1,a.showValidateUser=!1,a.showAddCredentialBlock=!1,a.showAddCredentialForm=!1,a.token="",c.isDefined(a.response)&&a.response&&e(function(){b.showInformation=!1,b.message.success=a.response.message},100),b.message.success="Verification link has been sent to "+a.esewaId,a.getCredentials())},function(a){b.showInformation=!1,b.message.success="",c.isDefined(a)&&(a.data?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later.")})},a.checkLogedInUsername=function(a){return b.$storage.profile.esewaId===a},a.setPassword=!1,a.makeActiveUser=function(b,c){a.showTokenBox=!0,a.token="",a.clearData(),a.addSecondaryUser(),c&&(a.validateMessage="Validate token for "+b),a.esewaId=b,a.showAddCredentialBlock=!1,a.showSetPassword=!1,a.showValidateUser=!0},a.changeMpin=function(b,c){a.passwordDto={},a.showMpinChange=c,a.showAddCredentialForm=c,c&&(a.validateMessage="ChangeMpin for "+b)},a.setNewMPIN=function(c){b.showloadingBar=!0,h.changeMpin(c).then(function(c){a.showMpinChange=!1,a.showAddCredentialForm=!1,b.message.error="",a.passwordDto=null,b.redirectMsg="MPIN successfully changed.",b.showloadingBar=!1,i.open({templateUrl:"/user/static/views/messageView.html",controller:q,size:"signUp",backdrop:"static",keyboard:!1})},function(a){b.showloadingBar=!1,a.data?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later."})};var q=["$scope","$rootScope","$modalInstance",function(a,b,c){b.currentModal=c,a.done=function(){d.reload()}}];a.cancelChangeMPIN=function(){a.passwordDto=null,d.go(StateConstant.HOME_MAIN)},a.cancelChangeMPIN=function(){a.showMpinChange=!1,a.showAddCredentialForm=!1,a.passwordDto=""},a.resetMpin=function(b,c){a.esewaId=b,i.open({templateUrl:"user/authentication/views/rest_mpin.html",controller:"MpinResetController",size:"md",resolve:{esewaId:function(){return b}}})},a.validateSecUser=function(d){a.disableSubmit=!0,a.showloadingBar=!0,a.userInfo={token:d,esewa_id:a.esewaId},h.validateSecondaryUser(a.userInfo).then(function(c){a.validationInfo=c.plain(),a.token="",a.showSetPassword=!0,a.showValidateUser=!1,a.showAddCredentialBlock=!1,a.showAddCredentialForm=!0,e(function(){b.message.error="",b.message.success="",p=k.secondaryRegistrationPasswordValidation,a.getInformationMessage()},300),a.getCredentials(),a.disableSubmit=!1,a.showloadingBar=!1},function(d){b.showInformation=!1,a.disableSubmit=!1,a.showloadingBar=!1,c.isDefined(d)&&(d.data?b.message.error=d.data.error_message:b.message.error="Service is currently unavailable. please, try again later.")})},a.checkPassword=function(){return a.passwordDto.newPassword===a.passwordDto.confirmNewPassword},a.setSecondaryPassword=function(d){a.disableSubmit=!0,a.showloadingBar=!0,a.tokenDto={token:a.userInfo.token},h.setPasswordForSecondary(a.esewaId,d,a.tokenDto).then(function(c){a.response=c.plain(),a.token="",a.tokenDto={},a.showSetPassword=!1,a.showValidateUser=!1,a.showAddCredentialBlock=!1,a.showAddCredentialForm=!1,a.response.message&&e(function(){b.showInformation=!1,b.message.success=a.response.message},100),a.showloadingBar=!1,a.disableSubmit=!1,a.getCredentials()},function(d){a.showloadingBar=!1,a.disableSubmit=!1,c.isDefined(d)&&(b.showInformation=!1,c.isDefined(d)&&(d.data?b.message.error=d.data.error_message:b.message.error="Service is currently unavailable. please, try again later to set password for the credentials.")),a.getCredentials()})},a.cancelAddUser=function(){a.showAddCredentialForm=!1,a.showAddCredentialBlock=!1,a.showValidateUser=!1,a.credential="",a.userInfo="",a.tokenDto={},a.token="",a.loginCredential={token:""},a.showTokenBox=!1},a.updateCredentials=function(b,c,d){a.openUpdateCredentialsDialog(b,c,d),a.cancelAddUser()},a.openUpdateCredentialsDialog=function(b,c,d){i.open({templateUrl:"user/logincredentials/views/update_confirmation_credentials.html",controller:"UpdateCredentialsController",size:"md",backdrop:"static",resolve:{userId:function(){return b},status:function(){return c},type:function(){return d},getCredentials:function(){return a.getCredentials}}})}}]),c.module("esewaProfileApp").controller("MpinResetController",["$modalInstance","$state","$scope","$rootScope","esewaId","MpinService","$timeout","ecmsg",function(a,b,d,e,f,g,h,i){d.close=function(){a.dismiss()},e.currentModal=a,d.resetMpin=function(){d.disableSubmit=!0,g.resetMPIN(f).then(function(a){d.disableSubmit=!1,d.response=a.plain(),i.success("MPIN reset successful. You have been sent MPIN in your mobile number.",""),d.response&&h(function(){e.successMessageForIndex=!1,e.showInformation=!1,e.message.success=d.response.message},100),d.close()},function(a){d.disableSubmit=!1,e.showInformation=!1,i.error("MPIN reset failed",""),c.isDefined(a)&&(a.data.error_message?e.message.error=a.data.error_message:e.message.error="Service is currently unavailable. please, try again later to change your MPIN.")})},d.cancelChangeMPIN=function(){d.close()}}]),c.module("esewaProfileApp").controller("UpdateCredentialsController",["$scope","$modalInstance","userId","status","type","$state","$timeout","$rootScope","SecUserService","getCredentials",function(a,b,d,e,f,g,h,i,j,k){a.credentialDto={status:e,esewaId:d},b.opened.then(function(){i.currentModal=b}),a.closeModal=function(){b.close(),i.currentModal=b},a.cancel=function(){a.closeModal()},a.type=f,a.updateCredentials=function(b){a.dto={status:e,esewa_id:d,remarks:b},"delete"===f?j.deleteCredentials(a.dto).then(function(b){a.response=b.plain(),g.reload(),a.closeModal(),h(function(){i.showInformation=!1,i.message.success=a.response.message},100),k()},function(b){a.closeModal(),i.showInformation=!1,c.isDefined(b)&&(b.data?i.message.error=b.data.error_message:i.message.error="Service is currently unavailable. please, try again later to delete credentials."),k()}):j.updateCredentialStatus(a.dto).then(function(b){a.response=b.plain(),g.reload(),a.closeModal(),h(function(){i.showInformation=!1,i.message.success=a.response.message},100),k()},function(b){a.closeModal(),i.showInformation=!1,c.isDefined(b)&&(b.data?i.message.error=b.data.error_message:i.message.error=NaN),k()})}}]),c.module("esewaProfileApp").service("SecUserService",["Restangular",function(a){var b=a.all("auth");this.addSecondaryUser=function(a){var c={esewa_id:a.esewaId,name:a.name};return b.all("login_credentials").post(c)},this.validateSecondaryUser=function(a){return b.one(a.esewa_id+"").one("token").one(a.token+"").one("validate_credentials_token").customGET()},this.setPasswordForSecondary=function(a,c,d){return b.one(a+"").one("create_credentials_pwd").customPOST(d,"","",{password:c.newPassword,mpin:c.mpin})},this.getSecondaryUsers=function(){return b.one("login_credentials").get()},this.deleteCredentials=function(a){return a.status="DELETED",b.all("login_credentials").one("status").customPUT(a)},this.updateCredentialStatus=function(a){return b.all("login_credentials").one("status").customPUT(a)},this.changeMpin=function(a){return b.one("change_mpin").customPOST(a)}}]),c.module("esewaProfileApp").controller("NotificationController",["$scope","$rootScope","$state","$timeout","ecmsg","PropertyConstant","NotificationService","$modal","AUTH_EVENTS","INFORMATION","$sce","RegexConstant","ActivationService","StateConstant","InformationService",function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){h.getNotifications().then(function(b){a.showloadingBar=!1,a.notificationIds=b.plain()},function(){a.showloadingBar=!1})}a.showTokenBox=!1,a.cancelAddNotificationId=function(){a.showTokenBox=!1,a.showAddNotificationForm=!1,a.$$phase||a.$apply(function(){a.clearData()})},a.initialRequirementForm=b.initialRequirement.form,a.initialRequirementType=b.initialRequirement.type,q(),b.clearMessage(),a.showloadingBar=!0,a.clearData=function(){a.showTokenBox=!1,a.notificationDto={notification_id:""},a.tokenDto={token:""},a.userInfo={token:"",notification_id:""}},a.clearData(),a.users={},a.showAddView=function(){a.notification={},a.clearData(),a.showAddNotificationForm=!0,a.showAddNotificationBlock=!0,a.showAlreadyGotTokenView=!1,a.showValidateUser=!1},a.cancelTokenValidation=function(){a.showAddUsers=!1},a.initialRequirementForm===g.userNotification&&(a.showAddView(),a.initialRequirementType===g.initialForceful&&(a.mandatory=!0));var r=k.notification;b.showInformation=!1,a.getInformationMessageForNotification=function(){b.informationKey=r,b.$broadcast(j.information)},a.typeOfMobile=function(a){return m.mobileNo.test(a)},a.notification={},a.addNotification=function(d){a.clearData(),a.showTokenBox=!0,a.notificationId=d.notification_id,d.notification_type=g.default,a.validateMessage=!1,h.addNotification(d).then(function(f){b.message.success="",b.message.error="",b.initialRequirement={},a.secondaryUserResponse=f.plain(),a.showAddNotificationBlock=!1,a.secondaryUserResponse.message!==g.statusActive&&a.typeOfMobile(d.notification_id)?(a.showValidateUser=!0,r=k.secondaryRegistrationToken,q(),e(function(){b.message.error="",b.message.success="",a.getInformationMessage()},300)):(a.showAddNotificationForm=!1,e(function(){b.showInformation=!1,c.isDefined(f)&&f.message&&(b.message.success=f.message)},100),q())},function(a){b.showInformation=!1,c.isDefined(a)&&(a.data?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later.")})},a.getInformationMessage=function(c){p.getInformation(c).then(function(c){b.information=c.plain(),b.information.information&&(a.showInformation=!0),b.trustedHtml=l.trustAsHtml(b.information.information)})},a.setPassword=!1,a.makeActiveNotification=function(b,c){a.clearData(),a.showTokenBox=!0,a.showAlreadyGotTokenView=!0,c&&(a.validateMessage="Validate token for "+b),a.notificationDto.notificationId=b,a.notificationId=b,a.showAddNotificationForm=!0,a.showAddNotificationBlock=!1,a.showValidateUser=!1},a.validateMobileAndToken=function(d){a.userInfo={token:d.token,notification_id:d.notificationId},h.validateToken(a.userInfo).then(function(c){a.validationInfo=c.plain(),a.showValidateUser=!1,a.showAddNotificationBlock=!1,a.showAddNotificationForm=!1,a.showAlreadyGotTokenView=!1,a.showAddNotificationForm=!0,e(function(){b.message.error="",b.message.success="",r=k.secondaryRegistrationPasswordValidation,a.getInformationMessage()},300),q()},function(a){b.showInformation=!1,c.isDefined(a)&&(a.data?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later.")})},a.resendToken=function(a){a&&n.resendNotification(g.notification,a).then(function(a){f.success("Token resent",""),b.message.success=a?a.data.error_message:"Notification resent successfully"},function(){b.message.error="Service is currently unavailable. please, try again later."})},a.validateToken=function(d){a.userInfo={token:d,notification_id:a.notificationId},h.validateToken(a.userInfo).then(function(c){a.validationInfo=c.plain(),a.showValidateUser=!1,a.showAddNotificationBlock=!1,a.showAddNotificationForm=!1,e(function(){b.message.error="",b.message.success="",r=k.secondaryRegistrationPasswordValidation,a.getInformationMessage()},300),a.clearData(),q()},function(a){b.showInformation=!1,c.isDefined(a)&&(a.data?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later.")})},a.cancelAddNotification=function(){a.showTokenBox=!1,a.initialRequirement.form===g.userNotification&&(b.initialRequirement={}),d.current.name===o.NOTIFICATIONS?a.showAddNotificationForm=!1:(a.showAddNotificationForm=!1,a.showAddNotificationBlock=!1,a.showValidateUser=!1,a.notificationDto="",a.userInfo="",d.reload())},a.updateForNotification=function(b,c,d){a.showAddNotificationForm=!1,a.showAddNotificationBlock=!1,a.showValidateUser=!1,a.clearData(),a.openUpdateCredentialsDialog(b,c,d)},a.notificationTypes=["DEFAULT","TRANSACTION"],a.openUpdateCredentialsDialog=function(a,b,c){i.open({templateUrl:"user/notificationids/views/update_confirmation_notification.html",controller:s,size:"md",backdrop:"static",resolve:{userId:function(){return a},status:function(){return b},type:function(){return c}}})};var s=["$scope","$modalInstance","userId","status","type","$state","$timeout","$rootScope",function(a,b,d,e,f,g,i,j){a.showAddNotificationForm=!1,a.credentialDto={status:e,notification_id:d},a.close=function(){b.dismiss()},a.cancel=function(){a.close()},a.type=f,j.currentModal=b,a.updateNotification=function(b){a.showTokenBox=!1,a.dto={status:b.status,notification_id:b.notification_id},"delete"===f?h.deleteNotification(b.notification_id).then(function(b){a.response=b.plain(),a.close(),i(function(){j.showInformation=!1,j.message.success=a.response.message},100),q()},function(b){a.close(),j.showInformation=!1,c.isDefined(b)&&(b.data?j.message.error=b.data.error_message:j.message.error="Service is currently unavailable. please, try again later to delete credentials.")}):h.updateNotificationStatus(a.dto).then(function(b){a.response=b.plain(),g.reload(),a.close(),i(function(){j.showInformation=!1,j.message.success=a.response.message},100),q()},function(b){a.close(),j.showInformation=!1,c.isDefined(b)&&(b.data?j.message.error=b.data.error_message:j.message.error=NaN)})}}]}]),c.module("esewaProfileApp").service("NotificationService",["Restangular",function(a){var b=a.all("auth").one("notification");this.addNotification=function(a){return b.customPOST(a)},this.validateToken=function(a){var c={token:a.token,notification_id:a.notification_id};return b.customPUT(c)},this.getNotifications=function(){return b.getList()},this.deleteNotification=function(a){return b.one(a).one("remove").customPUT("")},this.updateNotificationStatus=function(a){return b.customPUT(a)}}]),c.module("esewaProfileApp").constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-is_logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized",changePassword:"CHANGE_PASSWORD",personalDetail:"PERSONAL_DETAIL",generalDetail:"GENERAL_DETAIL",identityDetail:"IDENTITY_DETAIL",notifications:"NOTIFICATIONS",initialRequirement:"INITIAL_REQUIREMENT",welcomeForm:"WELCOME_FORM",getBalanceAndRewards:"get-balance-and-rewards",getShowcases:"get-show-case",getFeaturedShowcases:"get-featured-show-case",getMenus:"get-menus",getProductCommission:"get-product-commission",information:"information",socket:"socket",devGruntPort:8e3,devServerPort:8100}),c.module("esewaProfileApp").constant("INFORMATION",{primaryRegistration:"PRIMARY_REGISTRATION_INFO",primaryRegistrationToken:"PRIMARY_REGISTRATION_TOKEN_INFO",primaryRegistrationPasswordValidation:"PRIMARY_REGISTRATION_CREATE_PASSWORD_INFO",secondaryRegistration:"SECONDARY_REGISTRATION_INFO",secondaryRegistrationToken:"SECONDARY_REGISTRATION_TOKEN_INFO",secondaryRegistrationPasswordValidation:"SECONDARY_REGISTRATION_CREATE_PASSWORD_INFO",kycPersonal:"KYC_PERSONAL_INFO",kycGeneral:"KYC_GENERAL_INFO",kycIdentity:"KYC_IDENTITY_INFO",userChangePassword:"USER_CHANGE_PASSWORD_INFO",userChangeMPIN:"USER_CHANGE_PIN_INFO",userPasswordExpire:"USER_PASSWORD_EXPIRE_INFO",userStatement:"USER_STATEMENT_INFO",forgotPassword:"FORGOT_PASSWORD",forgotPasswordValidation:"FORGOT_PASSWORD_VALIDATION",notification:"NOTIFICATION"}),c.module("esewaProfileApp").constant("LabelConstant",{fullName:"Name",permanentAddress:"Permanent Address",currentAddress:"Current Address",fatherName:"Father's or Husband's Name",motherName:"Mother's Name",spouseName:"Spouse's Name",grandFatherName:"Grand Father's or Father-in-law's Name",panNo:"PAN No",landlineNo:"Landline No",occupation:"Occupation",dateOfBirth:"Date of Birth",gender:"Gender",setSameAsPermanent:"Same as permanent"}),c.module("esewaProfileApp").constant("MessageConstant",{dataFetchError:"Error while fetching data. Please, try again later.",serviceNotAvailable:"Service is currently unavailable. please, try again later."}),c.module("esewaProfileApp").constant("ResponseConstant",{userActivitiesActivities:"userActivities.activities",activityTime:"activity_time",activityDate:"activity_date",showcases:"showcases.offers",featuredShowcases:"featuredShowcases.featuredOffers"}),c.module("esewaProfileApp").controller("ActivationController",["$scope","$rootScope","$state","$stateParams","ActivationService","ecmsg","$sce","INFORMATION","InformationService","$timeout","NotificationService","StateConstant","AUTH_EVENTS",function(a,b,d,e,f,g,h,i,j,k,l,m,n){a.token=e.token,a.currentState=d.current.name;var o="";a.esewaId="",b.message.error="","activate.setPasswordForEmailUser"===a.currentState&&f.getUserTokenActivation(a.token,"USER_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username,a.showToken=!1),d.go("login")},function(){g.error("Activation link is either invalid or expired !!",""),d.go("login")}),"activate.setPasswordForPrimaryUser"===a.currentState?f.getUserTokenActivation(a.token,"USER_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username,a.showToken=!0,f.sendPrimaryUserToken(a.esewaId,a.token).then(function(b){a.response=b.plain(),a.token=""},function(){}))},function(){g.error("Activation link is either invalid or expired !!",""),d.go("login")}):"activate.setForgottenPassword"===a.currentState?f.getUserTokenActivation(a.token,"FORGET_PASSWORD").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username),o=i.forgotPasswordValidation},function(){g.error("Activation link is either invalid or expired !!",""),d.go("login")}):"activateNotification"===a.currentState&&(b.isAuthenticated()?(a.notificationDto={token:a.token},f.getUserTokenActivation(a.token,"NOTIFICATION_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username)},function(){g.error("Activation link is either invalid or expired !!",""),d.go("login")})):(g.error("You must be logged in for this operation or open this link from logged in browser!!",""),d.go("login"))),a.password={password:"",confirm_password:""},a.validateToken=function(b,e){a.userInfo={token:b,notificationId:e},l.validateToken(a.userInfo).then(function(b){a.validationInfo=b.plain(),a.showValidateUser=!1,k(function(){g.success("Notification ID is activated",""),d.go(m.NOTIFICATIONS)},300)},function(a){c.isDefined(a)&&(a.data?g.error(a.data.error_message,""):g.error("Service is currently unavailable. please, try again later",""),d.go(m.LOGIN))})},a.setPasswordForEmailUser=function(){(a.esewaId||a.passwordDto.mobileToken||"activate.setPasswordForPrimaryUser"!==a.currentState)&&(a.tokenDto={token:a.token,mobileToken:a.passwordDto.mobileToken},a.passwordDto.newPassword===a.passwordDto.confirmNewPassword?f.setPasswordForEmailUser(a.esewaId,a.tokenDto,a.passwordDto).then(function(c){g.success(c.plain().message,""),a.loginDto={esewaId:a.esewaId,password:a.passwordDto.newPassword},b.login(a.loginDto)},function(){g.error("Invalid Request !!","")}):g.error("Please, Check your password !!",""))},a.setNewForgottenPassword=function(){a.setPasswordDto={token:a.token,password:a.passwordDto.password},f.setNewForgottenPassword(a.esewaId,a.setPasswordDto).then(function(a){g.success(a.plain().message,""),d.go("login")},function(){g.error("Invalid Request !!","")})},a.addNotification=function(){a.validateToken(a.token,a.esewaId)},a.checkPassword=function(){return a.password.password===a.password.confirm_password},a.cancel=function(){d.go("login")},a.showInformation=!1,o&&(b.informationKey=o,b.$broadcast(n.information))}]),c.module("esewaProfileApp").controller("BankInfoController",["$scope","$rootScope","$state","InformationService",function(a,b,d,e){e.getInternetBankingDetails().then(function(b){a.internetBankingDetails=b.plain().bank_list},function(a){c.isDefined(a)?b.message=a.data.error_message:b.message="Error while fetching data."}),e.getMobileBankingDetails().then(function(b){return a.mobileBankingDetails=b.plain().bank_list,a.mobileBankingDetails},function(a){c.isDefined(a)?b.message=a.data.error_message:b.message="Error while fetching data."})}]),c.module("esewaProfileApp").controller("StaticController",["$scope","$state","$rootScope","StateConstant",function(a,b,c,d){a.staticMenus=[{url:d.TOPUP,name:"Direct Topup"},{url:d.AIRLINES_HOME,name:"Airlines"},{url:d.WU,name:"Fund Transfer"}],a.setShowStaticContent=function(d){c.showStaticContent=!0,a.showStaticContent=!0,b.go(d)}}]),c.module("esewaProfileApp").service("ActivationService",["Restangular",function(a){this.getUserTokenActivation=function(b,c){var d=_.merge({activation_type:c},{token:b});return a.one("token").one("validate").get(d)},this.setPasswordForEmailUser=function(b,c,d){var e={token:c.token};return c.mobileToken&&(e.token=c.mobileToken),a.one("esewa").one(b+"").one("create_password").customPOST(e,"","",{password:d.newPassword,username:d.username})},this.setNewForgottenPassword=function(b,c){return a.one(b+"").one("forgot_password").customPUT(c)},this.resendNotification=function(b,c){var d={type:b,notification_id:c};return a.one("auth").one("token").one("resend").customPUT(d)},this.sendPrimaryUserToken=function(b,c){var d={esewa_id:b,token:c};return a.one("auth").one("verify_email").customPOST(d)}}]),c.module("esewaProfileApp").controller("UserActivityController",["$scope","$rootScope","$state","$timeout","UserActivityScrollService","ResponseConstant","UserActivityService",function(a,b,d,e,f,g){function h(a){return a<10?"0"+a:a}b.successResponse={message:""},b.successMessageForIndex=!1,a.userActivities=new f,a.$watch(g.userActivitiesActivities,function(b,d){if(a.userActivities.activities){var e=b;a.data={messages:[]};for(var f=0;f<e.length;f++)a.data.messages.push({activity_date:new Date(e[f].activity_date),activity_time:e[f].activity_date,message:e[f].message,username:e[f].username,channel:e[f].channel});a.data.messages=_.sortBy(a.data.messages,g.activityTime).reverse(),a.filteredData={},c.copy(a.data,a.filteredData),a.filteredData.messages=a.convertToDate(a.filteredData.messages,g.activityDate)}}),a.convertToDate=function(a,b){for(var c={},d=0,e=0;d=a.length,e<d;e++){var f=a[e][b];a[e][b]=f.getFullYear()+"/"+h(f.getMonth()+1)+"/"+h(f.getDate()),c[a[e][b]]=c[a[e][b]]||[],c[a[e][b]].push(a[e]),c[a[e][b]]=_.sortBy(c[a[e][b]],g.activityTime).reverse()}return c}}]),c.module("esewaProfileApp").controller("UserPersonalInformationController",["$scope","$rootScope","$filter","$state","UserActivityService","$localStorage","UserActivityFactory","$modal",function(a,b,d,e,f,g,h,i){function j(){o(!0),f.getUserSavedBankList().then(function(a){k(a)},function(a){l(a)}).finally(function(){o(!1)})}function k(b){a.bankAccountList=b.plain()}function l(a){b.message.error=m(a)}function m(a){var b;return c.isDefined(a.data.error_message)&&(b=a.data.error_message),b||"Error while processing your request."}function n(){h.getBankList().length?a.bankList=h.getBankList():f.getbankBankList().then(function(b){a.bankList=b.plain(),h.saveBankList(a.bankList)},function(a){l(a)})}function o(b){a.showloadingBar=b}function p(a,b,d){var e=c.copy(a);return b?e.bank_code=e.selectedBank.swift_code:(e.status=c.isDefined(d)?d:"ACTIVE",c.isDefined(e.account_holder_name)&&(e.account_name=e.account_holder_name.replace(/\s+/g," "),delete e.account_holder_name),c.isDefined(e.selectedBank)&&(e.swift_code=e.selectedBank.swift_code),c.isUndefined(a.is_personal_account)&&(e.is_personal_account=h.getIsPersonalAccountParam())),e.selectedBank&&delete e.selectedBank,e}function q(b){h.saveResponseOfBankValidation(b),h.saveIsPersonalAccountParam(a.isPersonalAccount),e.go("user.addBankInformation.confirmation")}function r(){h.saveResponseOfBankValidation(),h.saveIsPersonalAccountParam(),h.saveBankInfo()}a.initFirstStepPageForBankInfo=function(){if(r(),j(),n(),!c.equals(h.getResponseOfAddBankInfo(),{})){var a=h.getResponseOfAddBankInfo()||{};h.saveResponseOfAddBankInfo(),200!==a.status?l(a):b.message.success="Bank Information Added Successfully."}},a.deleteBankAccount=function(b){i.open({templateUrl:"/user/userbankinformation/views/delete_bank_account_dailog_box.html",backdrop:!0,windowClass:"modal",scope:a,controller:["$scope","$modalInstance","UserActivityService","$filter",function(a,c,d,e){var f=b,g=a.getBankName(f.swift_code),h=f.is_personal_account?"your ":e("reverse_camel_case")(f.account_name)+"'s ";a.deleteAccountMsg="Are you sure you want to delete "+h+g+" (A/c no : "+f.account_number+") account from wallet ?",a.deleteAccount=function(){var e=p(b,!1,"DELETED");o(!0),d.deleteBankAccount(e).then(function(){for(var c=0;c<a.$parent.bankAccountList.length;c++)b===a.$parent.bankAccountList[c]&&a.$parent.bankAccountList.splice(c,1)},function(a){l(a)}).finally(function(){o(!1),c.dismiss()})},a.cancel=function(){c.dismiss("cancel")}}]})},a.getBankName=function(b){var d;return c.forEach(a.bankList,function(a,e){c.isUndefined(d)&&a.swift_code===b&&(d=a.bank_display_name)}),d},a.goToSecondStep=function(a){h.saveIsPersonalAccountParam(a),e.go("user.addBankInformation.secondStep")},a.initSecondStepContent=function(){c.isDefined(h.getIsPersonalAccountParam())?(a.bankInfo=h.getSavedBankInfo()||{},a.isPersonalAccount=h.getIsPersonalAccountParam(),a.isPersonalAccount&&(a.bankInfo.account_holder_name=d("reverse_camel_case")(g.profile.username.toLocaleLowerCase())),h.saveIsPersonalAccountParam(),n()):e.go("user.addBankInformation.firstStep")},a.resetAndGoToFirstStep=function(){r(),e.go("user.addBankInformation.firstStep")},a.validateBankInfo=function(a){h.saveBankInfo(a);var b=p(a,!0);o(!0),f.validateBankInfo(b).then(function(a){q(a.plain())},function(a){l(a)}).finally(function(){o(!1)})},a.initConfirmationPage=function(){var b=h.getBankValidationResponse();if(c.equals(b,{}))e.go("user.addBankInformation.firstStep");else if(a.isBankInfoVerifed=0===b.code,a.isBankInfoVerifed)a.bankInfo=h.getSavedBankInfo();else{var f=h.getSavedBankInfo().selectedBank.bank_display_name,g=h.getSavedBankInfo().account_number,i=h.getIsPersonalAccountParam()?"your ":d("reverse_camel_case")(h.getSavedBankInfo().account_holder_name)+"'s ";a.uiValidationFailErrorMsg="Sorry, we couldn't verify "+i+f+" (A/c No: "+g+") account from our system.",a.serverVerificationFailMsg=b.message}},a.addBankAccount=function(){var b=p(a.bankInfo);r(),o(!0),f.addBankInfo(b).then(function(a){c.isDefined(a)&&h.saveResponseOfAddBankInfo(a)},function(a){h.saveResponseOfAddBankInfo(a)}).finally(function(){o(!1),e.go("user.addBankInformation.firstStep")})}}]),c.module("esewaProfileApp").service("UserActivityFactory",[function(){var a,b={},d={},e={},f=[];this.saveBankInfo=function(a){b=c.copy(a)},this.getSavedBankInfo=function(){return b},this.saveBankList=function(a){f=a},this.getBankList=function(){return f},this.saveResponseOfBankValidation=function(a){d=c.copy(a)},this.getBankValidationResponse=function(){return d},this.saveIsPersonalAccountParam=function(b){a=b},this.getIsPersonalAccountParam=function(){return a},this.saveResponseOfAddBankInfo=function(a){e=c.copy(a)},this.getResponseOfAddBankInfo=function(){return e}}]),c.module("esewaProfileApp").service("UserActivityScrollService",["Restangular","PaginationService",function(a,b){var c=function(){this.activities=[],this.busy=!1,this.complete=!1,this.pageNumber=1,this.pageSize=15,this.emptyResult=!1,this.nextPage()};return c.prototype.nextPage=function(){if(!this.busy&&!this.complete){this.busy=!0;var c=this,d=b.getPagination(c.pageNumber-1,c.pageSize),e=null;return e=a.all("auth").all("activity").getList(d),e.then(function(a){c.busy=!1,a.length<c.pageSize&&(c.complete=!0,0===a.length&&0===c.pageNumber&&(c.emptyResult=!0)),a.length>0&&(c.activities=c.activities.concat(a)),c.pageNumber=c.pageNumber+1},function(){c.busy=!1,c.emptyResult=!0,c.complete=!0}),e}},c}]),c.module("esewaProfileApp").service("UserActivityService",["Restangular",function(a){var b=a.all("auth");this.getUserActivities=function(){return b.one("activity").getList()},this.getUserSavedBankList=function(){return b.one("bank_information").get()},this.addBankInfo=function(a){return b.one("bank_information").customPOST(a)},this.validateBankInfo=function(a){return b.one("bank").one("withdraw").one("validate").customPOST(a)},this.updateBankInfo=function(a){return b.one("bank_information").put(a)},this.getbankBankList=function(){return b.one("bank").one("withdraw").getList()},this.deleteBankAccount=function(a){return b.one("bank_information").customPUT(a)}}]),c.module("esewaProfileApp").controller("UserDeviceController",["$scope","$timeout","DeviceService","$modal","$rootScope",function(a,b,d,e,f){function g(){d.getDevices().then(function(b){a.devices=b,a.devices?0===a.devices.length&&(a.deviceNotavailableMessage="Currently devices are not available. You can add device using eSewa's mobile App."):a.deviceNotavailableMessage="Currently devices are not available. You can add device using eSewa's mobile App."},function(a){f.message.error="Opps! Something went wrong."})}f.clearMessage(),g(),a.updateDevice=function(b,c,d){a.openUpdateDeviceDialog(b,c,d)},a.openUpdateDeviceDialog=function(a,b,c){e.open({templateUrl:"user/userdevices/views/update_confirmation_device.html",controller:h,size:"md",backdrop:"static",resolve:{id:function(){return a},type:function(){return c},deviceName:function(){return b}}})};var h=["$scope","$modalInstance","id","type","deviceName",function(a,e,h,i,j){a.device={type:i,deviceName:j,id:h},a.close=function(){e.dismiss()},a.cancel=function(){a.close()},f.currentModal=e,a.updateDevice=function(e){"remove"===i?d.deleteDevice(e).then(function(c){a.successResponse=c.plain(),g(),a.close(),b(function(){f.showInformation=!1,f.message.success=a.successResponse.message},500)},function(b){a.close(),f.showInformation=!1,c.isDefined(b)&&(b.data.error_message?f.message.error=b.data.error_message:f.message.error="Service is currently unavailable. please, try again later to remove device.")}):"block"===i?d.updateDeviceStatus(e,"BLOCKED").then(function(c){a.successResponse=c.plain(),g(),a.close(),b(function(){f.showInformation=!1,f.message.error=!1,f.message.success=a.successResponse.message},500)},function(b){a.close(),f.showInformation=!1,c.isDefined(b)&&(b.data.error_message?f.message.error=b.data.error_message:f.message.error="Service is currently unavailable. please, try again later to update device status.")}):d.updateDeviceStatus(e,"ACTIVE").then(function(c){a.successResponse=c.plain(),g(),a.close(),b(function(){f.showInformation=!1,f.message.error=!1,f.message.success=a.successResponse.message},500)},function(b){a.close(),f.showInformation=!1,c.isDefined(b)&&(b.data.error_message?f.message.error=b.data.error_message:f.message.error="Service is currently unavailable. please, try again later to update device status.")})}}]}]),c.module("esewaProfileApp").service("DeviceService",["Restangular",function(a){var b=a.all("auth");this.getDevices=function(){return b.one("device").customGET()},this.deleteDevice=function(a){return b.one("device").one(a+"").one("remove").customPOST()},this.updateDeviceStatus=function(a,c){return b.one("device").one(a+"").one("status").one(c+"").customPUT()}}])}(window.jQuery,window,window.angular),function(a,b,c,d){"use strict";c.module("esewaProfileApp",["restangular","ngStorage","esewaMessages","esewaSharedApp","ui.router"]).run(["$rootScope","$state","$localStorage","$http","$timeout","$sce","$location","$templateCache",function(a,b,c,d,e,f,g,h){}]),c.module("esewaProfileApp").controller("ChangePasswordCtrl",["$scope","$rootScope","$state","AuthService","$timeout","InformationService","INFORMATION","$sce","StateConstant","AUTH_EVENTS","ecmsg","MessageConstant",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){this.oldPassword="",this.newPassword=""}function n(){b.informationKey=o,b.$broadcast(j.information)}a.showloadingBar=!1;var o=g.userChangePassword;b.showInformation=!0,b.clearMessage(),a.password=new m,a.initChangePassword=function(){a.passwordDto=new m},a.checkNewPassword=function(){return a.passwordDto.newPassword!==a.passwordDto.confirmNewPassword},a.isNewPasswordAndOldPasswordSame=function(){return a.passwordDto.oldPassword===a.passwordDto.newPassword},a.cancelChangePassword=function(){a.passwordDto=null,c.go(i.HOME_MAIN)},a.changePassword=function(c){a.showloadingBar=!0,d.changePassword(c).then(function(c){a.success=c.plain(),e(function(){b.successMessageForIndex=!0,b.redirectMsg=a.success.message},500),delete b.$storage.changePassword,$modal.open({templateUrl:"/user/static/views/messageView.html",controller:p,size:"signUp",backdrop:"static",keyboard:!1})},function(c){a.showloadingBar=!1,c.data?b.message.error=c.data.error_message:b.message.error=l.serviceNotAvailable})};var p=["$scope","$rootScope","$modalInstance",function(a,b,c){b.currentModal=c,a.done=function(){b.logout()}}];n(),a.cancel=function(){c.go(i.HOME_MAIN)}}]),c.module("esewaProfileApp").controller("HomeController",["$rootScope","$scope",function(a,b){a.clearMessage(),a.$$phase||a.$apply(function(){a.showMostUsedServices=!0,a.showAddServices=!0})}]),c.module("esewaProfileApp").controller("InitialRequirementController",["$scope","$rootScope","$modal","$state","$window","AUTH_EVENTS","PropertyConstant","StateConstant",function(a,b,c,d,e,f,g,h){a.initialRequirement=b.initialRequirement,a.initialRequirement&&(a.openConfirmPersonalDetailDialog=function(a){c.open({templateUrl:"/user/authentication/views/initial_requirement_popup.html",controller:i,size:"lg",backdrop:"static",keyboard:!1,resolve:{initialRequirement:function(){return a}}})});var i=["$rootScope","$scope","initialRequirement","$state","$modalInstance","AUTH_EVENTS","CDNUrl","StateConstant",function(a,b,c,d,e,f,h,i){b.htmlLinkForInitialRequirement=c.url,a.showWelcomePage?(b.forceful=!1,a.showWelcomePage=!1,b.htmlLinkForInitialRequirement=h.welcomeForm):c.type===g.initialForceful&&(b.forceful=c.type),b.cancel=function(){c.type!==g.initialForceful&&(delete a.$storage.initialRequirement,d.go(i.HOME_MAIN),e.dismiss()),a.$broadcast(f.initialRequirement)},a.currentModal=e}];a.initialRequirement&&a.initialRequirement.url?a.openConfirmPersonalDetailDialog(a.initialRequirement):d.go(h.HOME_MAIN)}]),c.module("esewaProfileApp").controller("MpinController",["$state","$rootScope","$scope","MpinService","$modal","ecmsg","InformationService","INFORMATION","$sce","$timeout","StateConstant",function(a,b,d,e,f,g,h,i,j,k,l){function m(){n.old_mpin="",n.new_mpin=""}var n=this;c.isDefined(b.$storage.profile)&&(b.$storage.profile.is_primary||a.go(l.HOME_MAIN)),n.showInformation=!1,b.clearMessage(),n.MPIN=new m,n.initChangePassword=function(){n.MPIN=new m},n.checkNewMPIN=function(){return n.MPIN.new_mpin!==n.confirm_new_mpin},n.isNewPasswordAndOldMPINSame=function(){return n.MPIN.old_mpin===n.MPIN.new_mpin},n.cancelChangeMPIN=function(){n.MPIN=null,n.confirm_new_mpin=null,a.go(l.HOME_MAIN)},n.changeMPIN=function(d){e.changeMPIN(d).then(function(b){console.log(b.plain()),n.MPIN=null,n.confirm_new_mpin=null,k(function(){b.message&&(g.success=b.message)},500),a.go(l.HOME_MAIN)},function(a){b.showInformation=!1,c.isDefined(a)&&(a.data.error_message?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later to change your MPIN.")})},n.resetMpin=function(d){e.changeMPIN(d).then(function(){n.MPIN=null,n.confirm_new_mpin=null,a.go(l.HOME_MAIN),b.message="Your MPIN is now reset."},function(a){c.isDefined(a.data.error_message)?b.message=a.data.error_message:b.error="Failed to change MPIN Check your correct MPIN and try again!!!!"})},n.resetMpinForUser=function(a){d.resetAvailable=!0,b.$storage.initialRequirement&&"FORCEFUL"===b.$storage.initialRequirement.type&&(d.resetAvailable=!1),d.resetAvailable&&f.open({templateUrl:"user/authentication/views/rest_mpin.html",controller:o,size:"md",resolve:{esewaId:function(){return a}}})};var o=["$modalInstance","$state","$scope","$rootScope","esewaId",function(a,b,d,f,g){d.close=function(){a.dismiss()},f.currentModal=a,d.resetMpin=function(){e.resetMPIN(g).then(function(a){d.response=a.plain(),n.MPIN=null,n.confirm_new_mpin=null,d.response&&k(function(){f.successMessageForIndex=!0,f.showInformation=!1,f.message.success=d.response.message},100),d.close()},function(a){f.showInformation=!1,c.isDefined(a)&&(a.data.error_message?f.message.error=a.data.error_message:f.message.error="Service is currently unavailable. please, try again later to change your MPIN.")})},d.cancelChangeMPIN=function(){d.close()}}]}]),c.module("esewaProfileApp").service("AuthService",["Restangular",function(a){var b=a.all("auth"),c=a.all("esewa");this.authenticate=function(b){return a.one("authenticate").customPOST("","","",{esewa_id:b.esewaId,password:b.password})},this.registerUserUsingEsewaId=function(a,b){var d={esewa_id:a.esewaId,email:a.email,"g-recaptcha-response":b,terms_and_conditions:a.termsAndCondition};return c.all("reg").post(d)},this.validateToken=function(a){return c.one(a.esewaId+"").one("token").one(a.token+"").one("validate").customGET()},this.validateLastToken=function(a){return c.one(a.esewaId+"").one("token").one(a.token+"").one("validate").customGET()},this.changePassword=function(a){return b.one("change_password").customPUT("","","",{old_password:a.oldPassword,new_password:a.newPassword})},this.setPassword=function(a){var b={token:a.token};return c.one(a.esewaId+"").one("create_password").customPOST(b,"","",{password:a.password})},this.getInitialRequirements=function(){return b.one("initial_requirements").get()},this.getUserProfile=function(){return b.one("profile").customGET()},this.logout=function(b){return a.all("logout").customPOST("","","",{esewa_id:b})}}]),c.module("esewaProfileApp").service("MpinService",["Restangular",function(a){var b=a.all("auth");this.resetMPIN=function(a){return b.one(a).all("reset_mpin").customPUT()}}]),c.module("esewaProfileApp").service("BalanceService",["Restangular",function(a){var b=a.all("auth");this.getBalance=function(){return b.one("balance").get()}}]),c.module("esewaProfileApp").service("RewardService",["Restangular",function(a){var b=a.all("auth");this.getRewardPoints=function(){return b.one("reward_point").get()}}]),c.module("esewaProfileApp").controller("CredentialsController",["$scope","$rootScope","$state","$timeout","MpinService","ecmsg","SecUserService","$modal","AUTH_EVENTS","INFORMATION","$sce","RegexConstant","ActivationService","PropertyConstant",function(a,b,d,e,f,g,h,i,j,k,l,m,n,o){a.loginCredential={token:""},b.message.success="",a.showTokenBox=!1,a.disableSubmit=!1,a.initialRequirementForm=b.initialRequirement.form,a.initialRequirementType=b.initialRequirement.type,a.getCredentials=function(){a.disableSubmit=!1,a.showloadingBar=!0,h.getSecondaryUsers().then(function(b){a.showloadingBar=!1,e(function(){a.$$phase||a.$apply(function(){a.users=b.plain()})},100)},function(){a.showloadingBar=!1})},a.showAddCredentialForm=!1,a.showAddCredentialBlock=!1,a.showSetPassword=!1,a.getCredentials(),b.clearMessage(),b.message.error="",b.showloadingBar=!1,a.clearData=function(){a.passwordDto={newPassword:"",confirmNewPassword:""},a.credential={esewaId:""},a.userInfo={token:"",esewaId:""}},a.clearData(),e(function(){"MOBILE_NUMBER"===a.initialRequirementForm&&(a.showAddUsers=!0,a.showAddCredentialForm=!0,a.showAddCredentialBlock=!0,a.initialRequirementType===o.initialForceful&&(a.mandatory=!0))},500),a.addSecondaryUser=function(){a.clearData(),a.showAddCredentialForm=!0,a.showAddCredentialBlock=!0,a.showSetPassword=!1,a.showValidateUser=!1,a.credential={}},a.cancelTokenValidation=function(){a.showAddUsers=!1};var p=k.secondaryRegistration;b.showInformation=!1,a.getInformationMessage=function(){b.informationKey=p,b.$broadcast(j.information)},a.typeOfMobile=function(a){return m.mobileNo.test(a)},a.resendToken=function(a){a&&n.resendNotification(o.user,a).then(function(a){a&&a.data?b.message.success=a.data.message:b.message.success="Notification resent successfully"},function(){b.message.error="Service is currently unavailable. please, try again later."})},a.addSecondaryCredentials=function(d){a.showTokenBox=!0,b.message.success="",b.message.error="",a.esewaId=d.esewaId,a.validateMessage=!1,h.addSecondaryUser(d).then(function(f){a.secondaryUserResponse=f.plain(),a.typeOfMobile(d.esewaId)?(a.showAddCredentialBlock=!1,a.showValidateUser=!0,p=k.secondaryRegistrationToken,a.getCredentials(),e(function(){b.message.error="",b.message.success="",a.getInformationMessage()},300)):(a.showSetPassword=!1,a.showValidateUser=!1,a.showAddCredentialBlock=!1,a.showAddCredentialForm=!1,a.token="",c.isDefined(a.response)&&a.response&&e(function(){b.showInformation=!1,b.message.success=a.response.message},100),b.message.success="Verification link has been sent to "+a.esewaId,a.getCredentials())},function(a){b.showInformation=!1,b.message.success="",c.isDefined(a)&&(a.data?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later.")})},a.checkLogedInUsername=function(a){return b.$storage.profile.esewaId===a},a.setPassword=!1,a.makeActiveUser=function(b,c){a.showTokenBox=!0,a.token="",a.clearData(),a.addSecondaryUser(),c&&(a.validateMessage="Validate token for "+b),a.esewaId=b,a.showAddCredentialBlock=!1,a.showSetPassword=!1,a.showValidateUser=!0},a.changeMpin=function(b,c){a.passwordDto={},a.showMpinChange=c,a.showAddCredentialForm=c,c&&(a.validateMessage="ChangeMpin for "+b)},a.setNewMPIN=function(c){b.showloadingBar=!0,h.changeMpin(c).then(function(c){a.showMpinChange=!1,a.showAddCredentialForm=!1,b.message.error="",a.passwordDto=null,b.redirectMsg="MPIN successfully changed.",b.showloadingBar=!1,i.open({templateUrl:"/user/static/views/messageView.html",controller:q,size:"signUp",backdrop:"static",keyboard:!1})},function(a){b.showloadingBar=!1,a.data?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later."})};var q=["$scope","$rootScope","$modalInstance",function(a,b,c){b.currentModal=c,a.done=function(){d.reload()}}];a.cancelChangeMPIN=function(){a.passwordDto=null,d.go(StateConstant.HOME_MAIN)},a.cancelChangeMPIN=function(){a.showMpinChange=!1,a.showAddCredentialForm=!1,a.passwordDto=""},a.resetMpin=function(b,c){a.esewaId=b,i.open({templateUrl:"user/authentication/views/rest_mpin.html",controller:"MpinResetController",size:"md",resolve:{esewaId:function(){return b}}})},a.validateSecUser=function(d){a.disableSubmit=!0,a.showloadingBar=!0,a.userInfo={token:d,esewa_id:a.esewaId},h.validateSecondaryUser(a.userInfo).then(function(c){a.validationInfo=c.plain(),a.token="",a.showSetPassword=!0,a.showValidateUser=!1,a.showAddCredentialBlock=!1,a.showAddCredentialForm=!0,e(function(){b.message.error="",b.message.success="",p=k.secondaryRegistrationPasswordValidation,a.getInformationMessage()},300),a.getCredentials(),a.disableSubmit=!1,a.showloadingBar=!1},function(d){b.showInformation=!1,a.disableSubmit=!1,a.showloadingBar=!1,c.isDefined(d)&&(d.data?b.message.error=d.data.error_message:b.message.error="Service is currently unavailable. please, try again later.")})},a.checkPassword=function(){return a.passwordDto.newPassword===a.passwordDto.confirmNewPassword},a.setSecondaryPassword=function(d){a.disableSubmit=!0,a.showloadingBar=!0,a.tokenDto={token:a.userInfo.token},h.setPasswordForSecondary(a.esewaId,d,a.tokenDto).then(function(c){a.response=c.plain(),a.token="",a.tokenDto={},a.showSetPassword=!1,a.showValidateUser=!1,a.showAddCredentialBlock=!1,a.showAddCredentialForm=!1,a.response.message&&e(function(){b.showInformation=!1,b.message.success=a.response.message},100),a.showloadingBar=!1,a.disableSubmit=!1,a.getCredentials()},function(d){a.showloadingBar=!1,a.disableSubmit=!1,c.isDefined(d)&&(b.showInformation=!1,c.isDefined(d)&&(d.data?b.message.error=d.data.error_message:b.message.error="Service is currently unavailable. please, try again later to set password for the credentials.")),a.getCredentials()})},a.cancelAddUser=function(){a.showAddCredentialForm=!1,a.showAddCredentialBlock=!1,a.showValidateUser=!1,a.credential="",a.userInfo="",a.tokenDto={},a.token="",a.loginCredential={token:""},a.showTokenBox=!1},a.updateCredentials=function(b,c,d){a.openUpdateCredentialsDialog(b,c,d),a.cancelAddUser()},a.openUpdateCredentialsDialog=function(b,c,d){i.open({templateUrl:"user/logincredentials/views/update_confirmation_credentials.html",controller:"UpdateCredentialsController",size:"md",backdrop:"static",resolve:{userId:function(){return b},status:function(){return c},type:function(){return d},getCredentials:function(){return a.getCredentials}}})}}]),c.module("esewaProfileApp").controller("MpinResetController",["$modalInstance","$state","$scope","$rootScope","esewaId","MpinService","$timeout","ecmsg",function(a,b,d,e,f,g,h,i){d.close=function(){a.dismiss()},e.currentModal=a,d.resetMpin=function(){d.disableSubmit=!0,g.resetMPIN(f).then(function(a){d.disableSubmit=!1,d.response=a.plain(),i.success("MPIN reset successful. You have been sent MPIN in your mobile number.",""),d.response&&h(function(){e.successMessageForIndex=!1,e.showInformation=!1,e.message.success=d.response.message},100),d.close()},function(a){d.disableSubmit=!1,e.showInformation=!1,i.error("MPIN reset failed",""),c.isDefined(a)&&(a.data.error_message?e.message.error=a.data.error_message:e.message.error="Service is currently unavailable. please, try again later to change your MPIN.")})},d.cancelChangeMPIN=function(){d.close()}}]),c.module("esewaProfileApp").controller("UpdateCredentialsController",["$scope","$modalInstance","userId","status","type","$state","$timeout","$rootScope","SecUserService","getCredentials",function(a,b,d,e,f,g,h,i,j,k){a.credentialDto={status:e,esewaId:d},b.opened.then(function(){i.currentModal=b}),a.closeModal=function(){b.close(),i.currentModal=b},a.cancel=function(){a.closeModal()},a.type=f,a.updateCredentials=function(b){a.dto={status:e,esewa_id:d,remarks:b},"delete"===f?j.deleteCredentials(a.dto).then(function(b){a.response=b.plain(),g.reload(),a.closeModal(),h(function(){i.showInformation=!1,i.message.success=a.response.message},100),k()},function(b){a.closeModal(),i.showInformation=!1,c.isDefined(b)&&(b.data?i.message.error=b.data.error_message:i.message.error="Service is currently unavailable. please, try again later to delete credentials."),k()}):j.updateCredentialStatus(a.dto).then(function(b){a.response=b.plain(),g.reload(),a.closeModal(),h(function(){i.showInformation=!1,i.message.success=a.response.message},100),k()},function(b){a.closeModal(),i.showInformation=!1,c.isDefined(b)&&(b.data?i.message.error=b.data.error_message:i.message.error=NaN),k()})}}]),c.module("esewaProfileApp").service("SecUserService",["Restangular",function(a){var b=a.all("auth");this.addSecondaryUser=function(a){var c={esewa_id:a.esewaId,name:a.name};return b.all("login_credentials").post(c)},this.validateSecondaryUser=function(a){return b.one(a.esewa_id+"").one("token").one(a.token+"").one("validate_credentials_token").customGET()},this.setPasswordForSecondary=function(a,c,d){return b.one(a+"").one("create_credentials_pwd").customPOST(d,"","",{password:c.newPassword,mpin:c.mpin})},this.getSecondaryUsers=function(){return b.one("login_credentials").get()},this.deleteCredentials=function(a){return a.status="DELETED",b.all("login_credentials").one("status").customPUT(a)},this.updateCredentialStatus=function(a){return b.all("login_credentials").one("status").customPUT(a)},this.changeMpin=function(a){return b.one("change_mpin").customPOST(a)}}]),c.module("esewaProfileApp").controller("NotificationController",["$scope","$rootScope","$state","$timeout","ecmsg","PropertyConstant","NotificationService","$modal","AUTH_EVENTS","INFORMATION","$sce","RegexConstant","ActivationService","StateConstant","InformationService",function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){h.getNotifications().then(function(b){a.showloadingBar=!1,a.notificationIds=b.plain()},function(){a.showloadingBar=!1})}a.showTokenBox=!1,a.cancelAddNotificationId=function(){a.showTokenBox=!1,a.showAddNotificationForm=!1,a.$$phase||a.$apply(function(){a.clearData()})},a.initialRequirementForm=b.initialRequirement.form,a.initialRequirementType=b.initialRequirement.type,q(),b.clearMessage(),a.showloadingBar=!0,a.clearData=function(){a.showTokenBox=!1,a.notificationDto={notification_id:""},a.tokenDto={token:""},a.userInfo={token:"",notification_id:""}},a.clearData(),a.users={},a.showAddView=function(){a.notification={},a.clearData(),a.showAddNotificationForm=!0,a.showAddNotificationBlock=!0,a.showAlreadyGotTokenView=!1,a.showValidateUser=!1},a.cancelTokenValidation=function(){a.showAddUsers=!1},a.initialRequirementForm===g.userNotification&&(a.showAddView(),a.initialRequirementType===g.initialForceful&&(a.mandatory=!0));var r=k.notification;b.showInformation=!1,a.getInformationMessageForNotification=function(){b.informationKey=r,b.$broadcast(j.information)},a.typeOfMobile=function(a){return m.mobileNo.test(a)},a.notification={},a.addNotification=function(d){a.clearData(),a.showTokenBox=!0,a.notificationId=d.notification_id,d.notification_type=g.default,a.validateMessage=!1,h.addNotification(d).then(function(f){b.message.success="",b.message.error="",b.initialRequirement={},a.secondaryUserResponse=f.plain(),a.showAddNotificationBlock=!1,a.secondaryUserResponse.message!==g.statusActive&&a.typeOfMobile(d.notification_id)?(a.showValidateUser=!0,r=k.secondaryRegistrationToken,q(),e(function(){b.message.error="",b.message.success="",a.getInformationMessage()},300)):(a.showAddNotificationForm=!1,e(function(){b.showInformation=!1,c.isDefined(f)&&f.message&&(b.message.success=f.message)},100),q())},function(a){b.showInformation=!1,c.isDefined(a)&&(a.data?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later.")})},a.getInformationMessage=function(c){p.getInformation(c).then(function(c){b.information=c.plain(),b.information.information&&(a.showInformation=!0),b.trustedHtml=l.trustAsHtml(b.information.information)})},a.setPassword=!1,a.makeActiveNotification=function(b,c){a.clearData(),a.showTokenBox=!0,a.showAlreadyGotTokenView=!0,c&&(a.validateMessage="Validate token for "+b),a.notificationDto.notificationId=b,a.notificationId=b,a.showAddNotificationForm=!0,a.showAddNotificationBlock=!1,a.showValidateUser=!1},a.validateMobileAndToken=function(d){a.userInfo={token:d.token,notification_id:d.notificationId},h.validateToken(a.userInfo).then(function(c){a.validationInfo=c.plain(),a.showValidateUser=!1,a.showAddNotificationBlock=!1,a.showAddNotificationForm=!1,a.showAlreadyGotTokenView=!1,a.showAddNotificationForm=!0,e(function(){b.message.error="",b.message.success="",r=k.secondaryRegistrationPasswordValidation,a.getInformationMessage()},300),q()},function(a){b.showInformation=!1,c.isDefined(a)&&(a.data?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later.")})},a.resendToken=function(a){a&&n.resendNotification(g.notification,a).then(function(a){f.success("Token resent",""),b.message.success=a?a.data.error_message:"Notification resent successfully"},function(){b.message.error="Service is currently unavailable. please, try again later."})},a.validateToken=function(d){a.userInfo={token:d,notification_id:a.notificationId},h.validateToken(a.userInfo).then(function(c){a.validationInfo=c.plain(),a.showValidateUser=!1,a.showAddNotificationBlock=!1,a.showAddNotificationForm=!1,e(function(){b.message.error="",b.message.success="",r=k.secondaryRegistrationPasswordValidation,a.getInformationMessage()},300),a.clearData(),q()},function(a){b.showInformation=!1,c.isDefined(a)&&(a.data?b.message.error=a.data.error_message:b.message.error="Service is currently unavailable. please, try again later.")})},a.cancelAddNotification=function(){a.showTokenBox=!1,a.initialRequirement.form===g.userNotification&&(b.initialRequirement={}),d.current.name===o.NOTIFICATIONS?a.showAddNotificationForm=!1:(a.showAddNotificationForm=!1,a.showAddNotificationBlock=!1,a.showValidateUser=!1,a.notificationDto="",a.userInfo="",d.reload())},a.updateForNotification=function(b,c,d){a.showAddNotificationForm=!1,a.showAddNotificationBlock=!1,a.showValidateUser=!1,a.clearData(),a.openUpdateCredentialsDialog(b,c,d)},a.notificationTypes=["DEFAULT","TRANSACTION"],a.openUpdateCredentialsDialog=function(a,b,c){i.open({templateUrl:"user/notificationids/views/update_confirmation_notification.html",controller:s,size:"md",backdrop:"static",resolve:{userId:function(){return a},status:function(){return b},type:function(){return c}}})};var s=["$scope","$modalInstance","userId","status","type","$state","$timeout","$rootScope",function(a,b,d,e,f,g,i,j){a.showAddNotificationForm=!1,a.credentialDto={status:e,notification_id:d},a.close=function(){b.dismiss()},a.cancel=function(){a.close()},a.type=f,j.currentModal=b,a.updateNotification=function(b){a.showTokenBox=!1,a.dto={status:b.status,notification_id:b.notification_id},"delete"===f?h.deleteNotification(b.notification_id).then(function(b){a.response=b.plain(),a.close(),i(function(){j.showInformation=!1,j.message.success=a.response.message},100),q()},function(b){a.close(),j.showInformation=!1,c.isDefined(b)&&(b.data?j.message.error=b.data.error_message:j.message.error="Service is currently unavailable. please, try again later to delete credentials.")}):h.updateNotificationStatus(a.dto).then(function(b){a.response=b.plain(),g.reload(),a.close(),i(function(){j.showInformation=!1,j.message.success=a.response.message},100),q()},function(b){a.close(),j.showInformation=!1,c.isDefined(b)&&(b.data?j.message.error=b.data.error_message:j.message.error=NaN)})}}]}]),c.module("esewaProfileApp").service("NotificationService",["Restangular",function(a){var b=a.all("auth").one("notification");this.addNotification=function(a){return b.customPOST(a)},this.validateToken=function(a){var c={token:a.token,notification_id:a.notification_id};return b.customPUT(c)},this.getNotifications=function(){return b.getList()},this.deleteNotification=function(a){return b.one(a).one("remove").customPUT("")},this.updateNotificationStatus=function(a){return b.customPUT(a)}}]),c.module("esewaProfileApp").constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-is_logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized",changePassword:"CHANGE_PASSWORD",personalDetail:"PERSONAL_DETAIL",generalDetail:"GENERAL_DETAIL",identityDetail:"IDENTITY_DETAIL",notifications:"NOTIFICATIONS",initialRequirement:"INITIAL_REQUIREMENT",welcomeForm:"WELCOME_FORM",getBalanceAndRewards:"get-balance-and-rewards",getShowcases:"get-show-case",getFeaturedShowcases:"get-featured-show-case",getMenus:"get-menus",getProductCommission:"get-product-commission",information:"information",socket:"socket",devGruntPort:8e3,devServerPort:8100}),c.module("esewaProfileApp").constant("INFORMATION",{primaryRegistration:"PRIMARY_REGISTRATION_INFO",primaryRegistrationToken:"PRIMARY_REGISTRATION_TOKEN_INFO",primaryRegistrationPasswordValidation:"PRIMARY_REGISTRATION_CREATE_PASSWORD_INFO",secondaryRegistration:"SECONDARY_REGISTRATION_INFO",secondaryRegistrationToken:"SECONDARY_REGISTRATION_TOKEN_INFO",secondaryRegistrationPasswordValidation:"SECONDARY_REGISTRATION_CREATE_PASSWORD_INFO",kycPersonal:"KYC_PERSONAL_INFO",kycGeneral:"KYC_GENERAL_INFO",kycIdentity:"KYC_IDENTITY_INFO",userChangePassword:"USER_CHANGE_PASSWORD_INFO",userChangeMPIN:"USER_CHANGE_PIN_INFO",userPasswordExpire:"USER_PASSWORD_EXPIRE_INFO",userStatement:"USER_STATEMENT_INFO",forgotPassword:"FORGOT_PASSWORD",forgotPasswordValidation:"FORGOT_PASSWORD_VALIDATION",notification:"NOTIFICATION"}),c.module("esewaProfileApp").constant("LabelConstant",{fullName:"Name",permanentAddress:"Permanent Address",currentAddress:"Current Address",fatherName:"Father's or Husband's Name",motherName:"Mother's Name",spouseName:"Spouse's Name",grandFatherName:"Grand Father's or Father-in-law's Name",panNo:"PAN No",landlineNo:"Landline No",occupation:"Occupation",dateOfBirth:"Date of Birth",gender:"Gender",setSameAsPermanent:"Same as permanent"}),c.module("esewaProfileApp").constant("MessageConstant",{dataFetchError:"Error while fetching data. Please, try again later.",serviceNotAvailable:"Service is currently unavailable. please, try again later."}),c.module("esewaProfileApp").constant("ResponseConstant",{userActivitiesActivities:"userActivities.activities",activityTime:"activity_time",activityDate:"activity_date",showcases:"showcases.offers",featuredShowcases:"featuredShowcases.featuredOffers"}),c.module("esewaProfileApp").controller("ActivationController",["$scope","$rootScope","$state","$stateParams","ActivationService","ecmsg","$sce","INFORMATION","InformationService","$timeout","NotificationService","StateConstant","AUTH_EVENTS",function(a,b,d,e,f,g,h,i,j,k,l,m,n){a.token=e.token,a.currentState=d.current.name;var o="";a.esewaId="",b.message.error="","activate.setPasswordForEmailUser"===a.currentState&&f.getUserTokenActivation(a.token,"USER_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username,a.showToken=!1),d.go("login")},function(){g.error("Activation link is either invalid or expired !!",""),d.go("login")}),"activate.setPasswordForPrimaryUser"===a.currentState?f.getUserTokenActivation(a.token,"USER_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username,a.showToken=!0,f.sendPrimaryUserToken(a.esewaId,a.token).then(function(b){a.response=b.plain(),a.token=""},function(){}))},function(){g.error("Activation link is either invalid or expired !!",""),d.go("login")}):"activate.setForgottenPassword"===a.currentState?f.getUserTokenActivation(a.token,"FORGET_PASSWORD").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username),o=i.forgotPasswordValidation},function(){g.error("Activation link is either invalid or expired !!",""),d.go("login")}):"activateNotification"===a.currentState&&(b.isAuthenticated()?(a.notificationDto={token:a.token},f.getUserTokenActivation(a.token,"NOTIFICATION_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username)},function(){g.error("Activation link is either invalid or expired !!",""),d.go("login")})):(g.error("You must be logged in for this operation or open this link from logged in browser!!",""),d.go("login"))),a.password={password:"",confirm_password:""},a.validateToken=function(b,e){a.userInfo={token:b,notificationId:e},l.validateToken(a.userInfo).then(function(b){a.validationInfo=b.plain(),a.showValidateUser=!1,k(function(){g.success("Notification ID is activated",""),d.go(m.NOTIFICATIONS)},300)},function(a){c.isDefined(a)&&(a.data?g.error(a.data.error_message,""):g.error("Service is currently unavailable. please, try again later",""),d.go(m.LOGIN))})},a.setPasswordForEmailUser=function(){(a.esewaId||a.passwordDto.mobileToken||"activate.setPasswordForPrimaryUser"!==a.currentState)&&(a.tokenDto={token:a.token,mobileToken:a.passwordDto.mobileToken},a.passwordDto.newPassword===a.passwordDto.confirmNewPassword?f.setPasswordForEmailUser(a.esewaId,a.tokenDto,a.passwordDto).then(function(c){g.success(c.plain().message,""),a.loginDto={esewaId:a.esewaId,password:a.passwordDto.newPassword},b.login(a.loginDto)},function(){g.error("Invalid Request !!","")}):g.error("Please, Check your password !!",""))},a.setNewForgottenPassword=function(){a.setPasswordDto={token:a.token,password:a.passwordDto.password},f.setNewForgottenPassword(a.esewaId,a.setPasswordDto).then(function(a){g.success(a.plain().message,""),d.go("login")},function(){g.error("Invalid Request !!","")})},a.addNotification=function(){a.validateToken(a.token,a.esewaId)},a.checkPassword=function(){return a.password.password===a.password.confirm_password},a.cancel=function(){d.go("login")},a.showInformation=!1,o&&(b.informationKey=o,b.$broadcast(n.information))}]),c.module("esewaProfileApp").controller("BankInfoController",["$scope","$rootScope","$state","InformationService",function(a,b,d,e){e.getInternetBankingDetails().then(function(b){a.internetBankingDetails=b.plain().bank_list},function(a){c.isDefined(a)?b.message=a.data.error_message:b.message="Error while fetching data."}),e.getMobileBankingDetails().then(function(b){return a.mobileBankingDetails=b.plain().bank_list,a.mobileBankingDetails},function(a){c.isDefined(a)?b.message=a.data.error_message:b.message="Error while fetching data."})}]),c.module("esewaProfileApp").controller("StaticController",["$scope","$state","$rootScope","StateConstant",function(a,b,c,d){a.staticMenus=[{url:d.TOPUP,name:"Direct Topup"},{url:d.AIRLINES_HOME,name:"Airlines"},{url:d.WU,name:"Fund Transfer"}],a.setShowStaticContent=function(d){c.showStaticContent=!0,a.showStaticContent=!0,b.go(d)}}]),c.module("esewaProfileApp").service("ActivationService",["Restangular",function(a){this.getUserTokenActivation=function(b,c){var d=_.merge({activation_type:c},{token:b});return a.one("token").one("validate").get(d)},this.setPasswordForEmailUser=function(b,c,d){var e={token:c.token};return c.mobileToken&&(e.token=c.mobileToken),a.one("esewa").one(b+"").one("create_password").customPOST(e,"","",{password:d.newPassword,username:d.username})},this.setNewForgottenPassword=function(b,c){return a.one(b+"").one("forgot_password").customPUT(c)},this.resendNotification=function(b,c){var d={type:b,notification_id:c};return a.one("auth").one("token").one("resend").customPUT(d)},this.sendPrimaryUserToken=function(b,c){var d={esewa_id:b,token:c};return a.one("auth").one("verify_email").customPOST(d)}}]),c.module("esewaProfileApp").controller("UserActivityController",["$scope","$rootScope","$state","$timeout","UserActivityScrollService","ResponseConstant","UserActivityService",function(a,b,d,e,f,g){function h(a){return a<10?"0"+a:a}b.successResponse={message:""},b.successMessageForIndex=!1,a.userActivities=new f,a.$watch(g.userActivitiesActivities,function(b,d){if(a.userActivities.activities){var e=b;a.data={messages:[]};for(var f=0;f<e.length;f++)a.data.messages.push({activity_date:new Date(e[f].activity_date),activity_time:e[f].activity_date,message:e[f].message,username:e[f].username,channel:e[f].channel});a.data.messages=_.sortBy(a.data.messages,g.activityTime).reverse(),a.filteredData={},c.copy(a.data,a.filteredData),a.filteredData.messages=a.convertToDate(a.filteredData.messages,g.activityDate)}}),a.convertToDate=function(a,b){for(var c={},d=0,e=0;d=a.length,e<d;e++){var f=a[e][b];a[e][b]=f.getFullYear()+"/"+h(f.getMonth()+1)+"/"+h(f.getDate()),c[a[e][b]]=c[a[e][b]]||[],c[a[e][b]].push(a[e]),c[a[e][b]]=_.sortBy(c[a[e][b]],g.activityTime).reverse()}return c}}]),c.module("esewaProfileApp").controller("UserPersonalInformationController",["$scope","$rootScope","$filter","$state","UserActivityService","$localStorage","UserActivityFactory","$modal",function(a,b,d,e,f,g,h,i){function j(){o(!0),f.getUserSavedBankList().then(function(a){k(a)},function(a){l(a)}).finally(function(){o(!1)})}function k(b){a.bankAccountList=b.plain()}function l(a){b.message.error=m(a)}function m(a){var b;return c.isDefined(a.data.error_message)&&(b=a.data.error_message),b||"Error while processing your request."}function n(){h.getBankList().length?a.bankList=h.getBankList():f.getbankBankList().then(function(b){a.bankList=b.plain(),h.saveBankList(a.bankList)},function(a){l(a)})}function o(b){a.showloadingBar=b}function p(a,b,d){var e=c.copy(a);return b?e.bank_code=e.selectedBank.swift_code:(e.status=c.isDefined(d)?d:"ACTIVE",c.isDefined(e.account_holder_name)&&(e.account_name=e.account_holder_name.replace(/\s+/g," "),delete e.account_holder_name),c.isDefined(e.selectedBank)&&(e.swift_code=e.selectedBank.swift_code),c.isUndefined(a.is_personal_account)&&(e.is_personal_account=h.getIsPersonalAccountParam())),e.selectedBank&&delete e.selectedBank,e}function q(b){h.saveResponseOfBankValidation(b),h.saveIsPersonalAccountParam(a.isPersonalAccount),e.go("user.addBankInformation.confirmation")}function r(){h.saveResponseOfBankValidation(),h.saveIsPersonalAccountParam(),h.saveBankInfo()}a.initFirstStepPageForBankInfo=function(){if(r(),j(),n(),!c.equals(h.getResponseOfAddBankInfo(),{})){var a=h.getResponseOfAddBankInfo()||{};h.saveResponseOfAddBankInfo(),200!==a.status?l(a):b.message.success="Bank Information Added Successfully."}},a.deleteBankAccount=function(b){i.open({templateUrl:"/user/userbankinformation/views/delete_bank_account_dailog_box.html",backdrop:!0,windowClass:"modal",scope:a,controller:["$scope","$modalInstance","UserActivityService","$filter",function(a,c,d,e){var f=b,g=a.getBankName(f.swift_code),h=f.is_personal_account?"your ":e("reverse_camel_case")(f.account_name)+"'s ";a.deleteAccountMsg="Are you sure you want to delete "+h+g+" (A/c no : "+f.account_number+") account from wallet ?",a.deleteAccount=function(){var e=p(b,!1,"DELETED");o(!0),d.deleteBankAccount(e).then(function(){for(var c=0;c<a.$parent.bankAccountList.length;c++)b===a.$parent.bankAccountList[c]&&a.$parent.bankAccountList.splice(c,1)},function(a){l(a)}).finally(function(){o(!1),c.dismiss()})},a.cancel=function(){c.dismiss("cancel")}}]})},a.getBankName=function(b){var d;return c.forEach(a.bankList,function(a,e){c.isUndefined(d)&&a.swift_code===b&&(d=a.bank_display_name)}),d},a.goToSecondStep=function(a){h.saveIsPersonalAccountParam(a),e.go("user.addBankInformation.secondStep")},a.initSecondStepContent=function(){c.isDefined(h.getIsPersonalAccountParam())?(a.bankInfo=h.getSavedBankInfo()||{},a.isPersonalAccount=h.getIsPersonalAccountParam(),a.isPersonalAccount&&(a.bankInfo.account_holder_name=d("reverse_camel_case")(g.profile.username.toLocaleLowerCase())),h.saveIsPersonalAccountParam(),n()):e.go("user.addBankInformation.firstStep")},a.resetAndGoToFirstStep=function(){r(),e.go("user.addBankInformation.firstStep")},a.validateBankInfo=function(a){h.saveBankInfo(a);var b=p(a,!0);o(!0),f.validateBankInfo(b).then(function(a){q(a.plain())},function(a){l(a)}).finally(function(){o(!1)})},a.initConfirmationPage=function(){var b=h.getBankValidationResponse();if(c.equals(b,{}))e.go("user.addBankInformation.firstStep");else if(a.isBankInfoVerifed=0===b.code,a.isBankInfoVerifed)a.bankInfo=h.getSavedBankInfo();else{var f=h.getSavedBankInfo().selectedBank.bank_display_name,g=h.getSavedBankInfo().account_number,i=h.getIsPersonalAccountParam()?"your ":d("reverse_camel_case")(h.getSavedBankInfo().account_holder_name)+"'s ";a.uiValidationFailErrorMsg="Sorry, we couldn't verify "+i+f+" (A/c No: "+g+") account from our system.",a.serverVerificationFailMsg=b.message}},a.addBankAccount=function(){var b=p(a.bankInfo);r(),o(!0),f.addBankInfo(b).then(function(a){c.isDefined(a)&&h.saveResponseOfAddBankInfo(a)},function(a){h.saveResponseOfAddBankInfo(a)}).finally(function(){o(!1),e.go("user.addBankInformation.firstStep")})}}]),c.module("esewaProfileApp").service("UserActivityFactory",[function(){var a,b={},d={},e={},f=[];this.saveBankInfo=function(a){b=c.copy(a)},this.getSavedBankInfo=function(){return b},this.saveBankList=function(a){f=a},this.getBankList=function(){return f},this.saveResponseOfBankValidation=function(a){d=c.copy(a)},this.getBankValidationResponse=function(){return d},this.saveIsPersonalAccountParam=function(b){a=b},this.getIsPersonalAccountParam=function(){return a},this.saveResponseOfAddBankInfo=function(a){e=c.copy(a)},this.getResponseOfAddBankInfo=function(){return e}}]),c.module("esewaProfileApp").service("UserActivityScrollService",["Restangular","PaginationService",function(a,b){var c=function(){this.activities=[],this.busy=!1,this.complete=!1,this.pageNumber=1,this.pageSize=15,this.emptyResult=!1,this.nextPage()};return c.prototype.nextPage=function(){if(!this.busy&&!this.complete){this.busy=!0;var c=this,d=b.getPagination(c.pageNumber-1,c.pageSize),e=null;return e=a.all("auth").all("activity").getList(d),e.then(function(a){c.busy=!1,a.length<c.pageSize&&(c.complete=!0,0===a.length&&0===c.pageNumber&&(c.emptyResult=!0)),a.length>0&&(c.activities=c.activities.concat(a)),c.pageNumber=c.pageNumber+1},function(){c.busy=!1,c.emptyResult=!0,c.complete=!0}),e}},c}]),c.module("esewaProfileApp").service("UserActivityService",["Restangular",function(a){var b=a.all("auth");this.getUserActivities=function(){return b.one("activity").getList()},this.getUserSavedBankList=function(){return b.one("bank_information").get()},this.addBankInfo=function(a){return b.one("bank_information").customPOST(a)},this.validateBankInfo=function(a){return b.one("bank").one("withdraw").one("validate").customPOST(a)},this.updateBankInfo=function(a){return b.one("bank_information").put(a)},this.getbankBankList=function(){return b.one("bank").one("withdraw").getList()},this.deleteBankAccount=function(a){return b.one("bank_information").customPUT(a)}}]),c.module("esewaProfileApp").controller("UserDeviceController",["$scope","$timeout","DeviceService","$modal","$rootScope",function(a,b,d,e,f){function g(){d.getDevices().then(function(b){a.devices=b,a.devices?0===a.devices.length&&(a.deviceNotavailableMessage="Currently devices are not available. You can add device using eSewa's mobile App."):a.deviceNotavailableMessage="Currently devices are not available. You can add device using eSewa's mobile App."},function(a){f.message.error="Opps! Something went wrong."})}f.clearMessage(),g(),a.updateDevice=function(b,c,d){a.openUpdateDeviceDialog(b,c,d)},a.openUpdateDeviceDialog=function(a,b,c){e.open({templateUrl:"user/userdevices/views/update_confirmation_device.html",controller:h,size:"md",backdrop:"static",resolve:{id:function(){return a},type:function(){return c},deviceName:function(){return b}}})};var h=["$scope","$modalInstance","id","type","deviceName",function(a,e,h,i,j){a.device={type:i,deviceName:j,id:h},a.close=function(){e.dismiss()},a.cancel=function(){a.close()},f.currentModal=e,a.updateDevice=function(e){"remove"===i?d.deleteDevice(e).then(function(c){a.successResponse=c.plain(),g(),a.close(),b(function(){f.showInformation=!1,f.message.success=a.successResponse.message},500)},function(b){a.close(),f.showInformation=!1,c.isDefined(b)&&(b.data.error_message?f.message.error=b.data.error_message:f.message.error="Service is currently unavailable. please, try again later to remove device.")}):"block"===i?d.updateDeviceStatus(e,"BLOCKED").then(function(c){a.successResponse=c.plain(),g(),a.close(),b(function(){f.showInformation=!1,f.message.error=!1,f.message.success=a.successResponse.message},500)},function(b){a.close(),f.showInformation=!1,c.isDefined(b)&&(b.data.error_message?f.message.error=b.data.error_message:f.message.error="Service is currently unavailable. please, try again later to update device status.")}):d.updateDeviceStatus(e,"ACTIVE").then(function(c){a.successResponse=c.plain(),g(),a.close(),b(function(){f.showInformation=!1,f.message.error=!1,f.message.success=a.successResponse.message},500)},function(b){a.close(),f.showInformation=!1,c.isDefined(b)&&(b.data.error_message?f.message.error=b.data.error_message:f.message.error="Service is currently unavailable. please, try again later to update device status.")})}}]}]),c.module("esewaProfileApp").service("DeviceService",["Restangular",function(a){var b=a.all("auth");this.getDevices=function(){return b.one("device").customGET()},this.deleteDevice=function(a){return b.one("device").one(a+"").one("remove").customPOST()},this.updateDeviceStatus=function(a,c){return b.one("device").one(a+"").one("status").one(c+"").customPUT()}}])}(window.jQuery,window,window.angular);