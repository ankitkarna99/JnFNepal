/*! 
 * esewaCustomerApp v0.0.0
 * 
 * Copyright (c) 2019 eSewa Developers <developers@esewa.com.np>
 * License: eSewa
+; * Version: 0.0.0
+; */
!function(){angular.module("esewaCustomerApp",["ui.router","restangular","ui.bootstrap","ngStorage","infinite-scroll","esewaComponents","esewaMessages","esewaSharedApp","esewaPaymentMenuApp","esewaPaymentApp","esewaProfileApp","ngCookies","ncy-angular-breadcrumb","ui.select","ngSanitize","base64"]).run(["$rootScope","$state","$localStorage","$http","AUTH_EVENTS","BalanceService","RewardService","MerchantPaymentService","AuthService","$timeout","$sce","$location","StateConstant","CDNUrl","$templateCache","ecmsg","$cookies","RegexConstant","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){a.$state=b,a.StateConstant=m,a.$storage=c,a.successResponse={message:""};var t=q.get("authesewa"),u=q.get("errormsg"),v=q.get("successmsg"),w=q.get("redirectForm");angular.isDefined(w)&&"null"!==w&&(a.targetLogin=w),t&&(a.uuid=t.split(":")[1],j(function(){a.afterLogin()},2e3)),u&&u.length>3?p.error(u,""):v&&v.length>3&&p.success(v,""),a.message={error:"",success:"",information:"",show:!1},a.cleanStorage=function(){delete a.$storage.userAuth,delete d.defaults.headers.common.uuid,delete a.$storage.profile,delete a.$storage.userDetail,delete c.status,a.initialRequirement={},a.userBalance="",a.UserRewardPoint="",a.dismissModal=!0},a.checkLoggedInMobile=function(){return r.mobileNo.test(a.$storage.profile.esewaId)},a.logout=function(){a.clearMessage(),a.cleanStorage();var c=document.querySelector("#ACCOUNT_ICON");c&&(c.src=n.defaultAccountUrl),8001===l.port()?b.current.name.startsWith("login")||b.go("login"):angular.element("#logoutForm").submit()},a.signOut=function(){a.cleanStorage(),a.$storage.profile||(a.$storage.profile={esewa_id:""}),i.logout(a.$storage.profile.esewa_id).then(function(){s.location.reload()},function(){s.location.reload()})},a.currentModal=void 0,a.isLoggedIn=function(){var a=q.get("authesewa");return angular.isDefined(a)&&angular.isDefined(a.split(":")[1])},a.isAuthenticated=function(){return a.isLoggedIn()},a.$on(e.loginSuccess,function(){a.initialRequirement.form||(a.targetLogin?a.serveUrlChanges():(b.current.name.startsWith("static")||b.current.name.startsWith("authentication"))&&b.go(m.HOME_MAIN))}),a.$on(e.loginFailed,function(){a.logout()}),a.$on(e.notAuthenticated,function(){a.logout()}),a.$on(e.notAuthorized,function(){a.logout()}),a.$on(e.sessionTimeout,function(){p.error("","Session expired. Please login again."),a.logout()}),a.clearMessage=function(){a.message={},a.dismissModal=!0,a.information={},a.trustedHtml="",a.showInformation=!1,a.credentials={},a.currentModal&&a.currentModal.dismiss()},a.serveUrlChanges=function(){l.absUrl()==a.targetLogin,a.$broadcast(e.getProductCommission),a.currentModal&&a.currentModal.dismiss()},a.$on(e.initialRequirement,function(){j(function(){a.showApplicationProcessing=!1,"CHANGE_PASSWORD"===a.initialRequirement.form?b.go(m.CHANGE_PASSWORD):"PERSONAL_DETAIL"===a.initialRequirement.form?b.go(m.KYC_ONE):"GENERAL_DETAIL"===a.initialRequirement.form?b.go(m.KYC_TWO):"IDENTITY_DETAIL"===a.initialRequirement.form?b.go(m.KYC_THREE):"USER_NOTIFICATION"===a.initialRequirement.form?b.go(m.NOTIFICATIONS):"MOBILE_NUMBER"===a.initialRequirement.form?b.go(m.LOGIN_CREDENTIALS):a.initialRequirement.form?b.go(m.INITIAL_REQUIREMENT):b.go(m.HOME_MAIN)},1e3)}),a.initialRequirement={form:"",type:"",url:""},a.$on("$stateChangeStart",function(b,c,d){a.information={},a.message={},a.showInformation=!1,"login"!==c.name&&"allShowcase"!==c.name&&"activateNotification"!==c.name&&((c.name.startsWith("main")||c.name.startsWith("authentication")||c.name.startsWith("merchant")||c.name.startsWith("fundFrom")||c.name.startsWith("serviceList")||c.name.startsWith("user")||c.name.startsWith("user")||c.name!==m.INITIAL_REQUIREMENT)&&("FORCEFUL"!==a.initialRequirement.type&&"SKIP_AND_NEVER_SEE_AGAIN"!==a.initialRequirement.type||("CHANGE_PASSWORD"===a.initialRequirement.form&&c.name!==m.CHANGE_PASSWORD?b.preventDefault():"PERSONAL_DETAIL"===a.initialRequirement.form&&c.name!==m.KYC_ONE?b.preventDefault():"MOBILE_NUMBER"===a.initialRequirement.form&&c.name!==m.LOGIN_CREDENTIALS?b.preventDefault():"IDENTITY_DETAIL"===a.initialRequirement.form&&c.name!==m.KYC_THREE?b.preventDefault():"NOTIFICATION"===a.initialRequirement.form&&c.name!==m.NOTIFICATIONS&&b.preventDefault())),j(function(){a.isAuthenticated()||c.name.startsWith("authentication")||c.name.startsWith("static")||c.name.startsWith("main")||c.name.startsWith("activate")||c.name.startsWith("merchant.makePayment")||c.name.startsWith("merchant.airlines")||(a.$broadcast(e.notAuthenticated),b.preventDefault())},10),"undefined"!=typeof d&&!c.name.startsWith("main"))}),b.current.name.startsWith("home")&&(a.showMostUsedServices=!0,a.showAddServices=!0),a.getParentStyle=function(){return b.current.name.startsWith("merchant.airlines")?"padding-left:0px":""},a.showErrorMessage=function(){return!(""===a.message.error||!angular.isDefined(a.message.error))&&!(b.current.name.startsWith("auth")&&a.isAuthenticated())},a.generateCaptcha=function(a){var b=document.querySelector("#CAPTCHA");d({method:"GET",url:"/api/web/captcha/"+a,headers:{"Content-Type":void 0,Accept:"data:image/png;charset=utf-8;base64"},responseType:"arraybuffer",data:""}).success(function(a){var c=new Blob([a],{type:"image/png"}),d=window.URL||window.webkitURL,e=d.createObjectURL(c);b&&(b.src=e)}).error(function(){})},j(function(){var b=l.port();80!=b&&(b=":"+b),a.domainName=l.protocol()+"://"+l.host()+b,l.port()===e.devGruntPort&&(a.domainName=l.protocol()+"://"+l.host()+":"+e.devServerPort),a.$broadcast(e.socket)},100)}])}(),function(){angular.module("esewaCustomerApp").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/home"),a.state("login",{url:"/home",templateUrl:"user/authentication/views/login.html",controller:"AuthController"}).state("main",{"abstract":!0,template:"<div  ui-view/>"}).state("main.landing",{url:"/main",templateUrl:"user/authentication/views/login.html",controller:"AuthController",data:{displayName:"Home"}}).state("main.initialRequirement",{url:"/initial_requirement",templateUrl:"user/authentication/views/initial_requirement.html",controller:"InitialRequirementController",data:{displayName:"Initial Requirement"}}).state("main.fundTransfer",{url:"/fund_transfer",templateUrl:"user/merchant/payments/views/transfer_fund.html",controller:"MerchantPaymentController",data:{displayName:" Fund Transfer"}}).state("main.fundTransfer.detail",{url:"/detail/:txnId",templateUrl:"user/merchant/statements/views/transaction_detail.html",controller:"TransactionDetailController",data:{displayName:" Detail"}}).state("main.bankWithdraw",{url:"/bank_withdraw",templateUrl:"user/merchant/payments/views/bank_withdraw.html",controller:"BankController",data:{displayName:"Bank Withdraw"}}).state("main.bankWithdraw.confirm",{templateUrl:"user/merchant/payments/views/bank_withdraw_confirm.html",data:{displayName:"confirm"}}).state("main.wuPickup",{url:"/wu_pickup",templateUrl:"user/merchant/payments/views/wu_pickup.html",controller:"MerchantPaymentController",data:{displayName:"WU pickup"}}).state("main.wuReceive",{url:"/wu_receive",templateUrl:"user/merchant/payments/views/wu_receive.html",controller:"MerchantPaymentController",data:{displayName:"WU receive"}}).state("fundFrom",{"abstract":!0,url:"/bank_load",templateUrl:"user/static/views/bank_load.html"}).state("fundFrom.internetBanking",{url:"/internet_banking",templateUrl:"user/static/views/internet_banking.html",controller:"BankInfoController",data:{displayName:"Internet Banking"}}).state("fundFrom.mobileBanking",{url:"/mobile_banking",templateUrl:"user/static/views/mobile_banking.html",controller:"BankInfoController",data:{displayName:"Mobile Banking"}}).state("fundFrom.friend",{url:"/friend",templateUrl:"user/merchant/payments/views/request_from_friend.html",controller:"BankInfoController",data:{displayName:"Friend"}}).state("serviceList",{url:"/service-list/internet-bill",templateUrl:"common/service_list.html",controller:"",data:{displayName:"Services"}}).state("unifiedkhanepani",{url:"/khanepani-payment",templateUrl:"common/unified_khanepani.html",controller:"KhanepaniController",data:{displayName:"Unified Khanepani"}}).state("merchant",{"abstract":!0,templateUrl:"user/home/views/merchant.html"}).state("merchant.statements",{url:"/statements",templateUrl:"user/merchant/statements/views/statement_list.html",controller:"StatementController",data:{displayName:"Statement"}}).state("merchant.makePayment",{url:"/make_payment/:product_code/:product_name",templateUrl:"user/merchant/payments/views/payment_template.html",controller:"MerchantPaymentController",data:{displayName:"Make Payment"}}).state("merchant.makePayment.secondStep",{url:"/paymentDetails",templateUrl:"user/merchant/payments/views/forms/secondStep.html",data:{displayName:"User Payment Details"}}).state("merchant.makePayment.vianet",{url:"/paymentDetails-Vianet",templateUrl:"user/merchant/payments/views/forms/vianet/vianetCustomerDetail.html",data:{displayName:"User Payment Details"}}).state("merchant.makePayment.confirm",{templateUrl:"user/merchant/payments/views/payment_confirm.html",data:{displayName:"Confirmation"}}).state("merchant.transaction",{url:"/transaction/:txnId/:moduleId",templateUrl:"user/merchant/statements/views/transaction_details.html",controller:"TransactionDetailController",data:{displayName:"Payment Detail"}}).state("merchant.airlines",{controller:"AirLinesController",controllerAs:"airlines",templateUrl:"user/merchant/airlines/views/airlines_home.html",ncyBreadcrumb:{label:"Airlines"}}).state("merchant.airlines.search",{url:"/airlines/search",templateUrl:"user/merchant/airlines/views/airlines_search.html",data:{displayName:"Airlines"},ncyBreadcrumb:{label:"Airlines search",parent:"merchant.airlines"}}).state("merchant.airlines.list",{url:"/airlines/list",templateUrl:"user/merchant/airlines/views/airlines_detail_list.html",data:{displayName:"List"},ncyBreadcrumb:{label:"Airlines details list",parent:"merchant.airlines.search"}}).state("merchant.airlines.passenger",{url:"/airlines/passenger",templateUrl:"user/merchant/airlines/views/passenger_detail.html",data:{displayName:"Passenger Detail"},ncyBreadcrumb:{label:"Passenger details",parent:"merchant.airlines.list"}}).state("merchant.airlines.confirmation",{url:"/airlines/confirmation",templateUrl:"user/merchant/airlines/views/airline_confirmation.html",data:{displayName:"Passenger Detail"},ncyBreadcrumb:{label:"Confirm details",parent:"merchant.airlines.passenger"}}).state("merchant.airlines.transactionDetail",{url:"/airlines/ticket/:moduleId/:txnId",templateUrl:"user/merchant/airlines/views/airlines_transaction_detail.html",data:{displayName:"Transaction Detail"}}).state("merchant.hotels",{controller:"HotelsController",templateUrl:"user/merchant/hotel/views/hotel_home.html",ncyBreadcrumb:{label:"Home"}}).state("merchant.hotels.search",{url:"/hotel/search",templateUrl:"user/merchant/hotel/views/hotel_search.html",data:{displayName:"Hotels"},ncyBreadcrumb:{label:"Hotel Search",parent:"merchant.hotels"}}).state("merchant.hotels.details",{url:"/hotel/details/:hotelId",templateUrl:"user/merchant/hotel/views/hotel_details.html",data:{displayName:"Hotels"},ncyBreadcrumb:{label:"Hotel Details",parent:"merchant.hotels"}}).state("merchant.hotels.confirmation",{url:"/hotel/booking-confirmation",templateUrl:"user/merchant/hotel/views/booking_confirmation.html",data:{displayName:"Hotels"},ncyBreadcrumb:{label:"Booking Confirmation",parent:"merchant.hotels"}}).state("merchant.directPayWorldlinkLim",{controller:"MerchantPaymentController",url:"/make_payment/eSewa_worldlink/Worldlink",templateUrl:"user/merchant/payments/views/payment_template.html"}).state("merchant.directPayWorldlinkUlim",{controller:"MerchantPaymentController",url:"/make_payment/eSewa_worldlink/Worldlink",templateUrl:"user/merchant/payments/views/payment_template.html"}).state("merchant.lekhnathPayment",{controller:"MerchantPaymentController",url:"/make_payment/WATERMARK/Lekhnath%20Khanepani",templateUrl:"user/merchant/payments/views/payment_template.html"}).state("user",{"abstract":!0,templateUrl:"user/home/views/profile.html"}).state("user.detail",{url:"/profile",templateUrl:"user/userkyc/views/kyc_details.html",controller:"AbstractUserController",data:{displayName:"Profile"},ncyBreadcrumb:{label:"Profile"}}).state("user.detail.one",{url:"/personal_details",templateUrl:"user/userkyc/views/kyc_category_one.html",controller:"UserProfileController",data:{displayName:"Personal Detail"}}).state("user.detail.three",{url:"/identity_details",templateUrl:"user/userkyc/views/kyc_category_three.html",controller:"UserProfileController",data:{displayName:"Identity Detail"}}).state("user.secondaryUsers",{url:"/login_credentials",templateUrl:"/user/logincredentials/views/login_credentials_users.html",controller:"CredentialsController",data:{displayName:"Credential"}}).state("user.notifications",{url:"/notifications",templateUrl:"/user/notificationids/views/notification_list.html",controller:"NotificationController",data:{displayName:"Notification"}}).state("activateNotification",{url:"/notification/activate_email?:token",templateUrl:"user/notificationids/views/email_activation.html",controller:"EmailActivationController",data:{displayName:"Notification Email Activation"}}).state("user.activities",{url:"/activities",templateUrl:"/user/useractivities/views/user_activity_list.html",controller:"UserActivityController",data:{displayName:"User Activity"}}).state("user.devices",{url:"/devices",templateUrl:"user/userdevices/views/user_devices.html",controller:"UserDeviceController",data:{displayName:"Device"}}).state("user.changePassword",{url:"/change_password",templateUrl:"user/authentication/views/change_password.html",controller:"ChangePasswordCtrl",data:{displayName:"Change Password"}}).state("user.changeMpin",{url:"/change_mpin",templateUrl:"user/authentication/views/change_mpin.html",controller:"CredentialsController",data:{displayName:"Change MPIN"}}).state("user.addBankInformation",{"abstract":!0,template:"<div ui-view></div>",ncyBreadcrumb:{label:"Profile"}}).state("user.addBankInformation.firstStep",{url:"/my-bank-information",templateUrl:"user/userbankinformation/views/add_bank_information_first_step.html",controller:"UserPersonalInformationController",ncyBreadcrumb:{label:"Bank Accounts",parent:"user.detail"}}).state("user.addBankInformation.secondStep",{url:"/my-bank-information/second-step",templateUrl:"user/userbankinformation/views/add_bank_information_second_step.html",controller:"UserPersonalInformationController",ncyBreadcrumb:{label:"Add Account",parent:"user.addBankInformation.firstStep"}}).state("user.addBankInformation.confirmation",{url:"/my-bank-information/confirmation",templateUrl:"user/userbankinformation/views/add_bank_information_confirmation_page.html",controller:"UserPersonalInformationController",ncyBreadcrumb:{label:"Account Information",parent:"user.addBankInformation.secondStep"}}).state("activate",{url:"/activate","abstract":!0,template:'<div class="theme_box" ui-view/>'}).state("activate.setPasswordForEmailUser",{url:"/signup?:token",templateUrl:"user/logincredentials/views/set_password_for_secondary_email_user.html",controller:"EmailActivationController",data:{displayName:"Email User Activation"}}).state("activate.setPasswordForPrimaryUser",{url:"/signup/verify?:token",templateUrl:"user/logincredentials/views/set_password_for_email_user.html",controller:"EmailActivationController",data:{displayName:"User Activation"}}).state("activate.setForgottenPassword",{url:"/forgot_password?:token",templateUrl:"user/authentication/views/set_forgotten_password.html",controller:"EmailActivationController",data:{displayName:"Activate"}}).state("static",{"abstract":!0,template:'<div ui-view class="x_panel" "/>'}).state("static.westernUnion",{url:"/western_union",templateUrl:"user/static/views/western_union.html",controller:"StaticController",data:{displayName:"Western Union"}}).state("static.smsSyntax",{url:"/sms_syntax",templateUrl:"user/static/views/sms_syntax.html",controller:"StaticController",data:{displayName:"SMS Syntax"}}).state("static.aboutEsewa",{url:"/about_esewa",templateUrl:"user/static/views/about_esewa.html",controller:"StaticController",data:{displayName:"About eSewa"}}).state("static.faqs",{url:"/faqs",templateUrl:"user/static/views/faqs.html",controller:"StaticController",data:{displayName:"FAQs"}}).state("static.mobileApps",{url:"/mobile_apps",templateUrl:"user/static/views/mobile_apps.html",controller:"StaticController",data:{displayName:"Mobile Apps"}}).state("static.rewardPoint",{url:"/reward_point",templateUrl:"user/static/views/reward_point.html",controller:"StaticController"}).state("static.contactInformation",{url:"/contact_information",templateUrl:"user/static/views/contact_information.html",controller:"StaticController",data:{displayName:"Contacts"}}).state("static.privacy",{url:"/privacy",templateUrl:"user/static/views/privacy.html",controller:"StaticController",data:{displayName:"Privacy"}}).state("static.gettingStarted",{url:"/getting_started",templateUrl:"user/static/views/getting_started.html",controller:"StaticController",data:{displayName:"Getting Started"}}).state("static.security",{url:"/security",templateUrl:"user/static/views/security.html",controller:"StaticController",data:{displayName:"Security"}}).state("static.termsAndConditions",{url:"/terms_and_conditions",templateUrl:"user/static/views/terms_and_conditions.html",controller:"StaticController",data:{displayName:"Terms and Conditions"}}).state("allShowcase",{templateUrl:"common/allShowcase.html",data:{displayName:"All Showcase"}}).state("offers",{url:"/offers",templateUrl:"https://cdn.esewa.com.np/ui/html/offers/user/all_offers.html"}).state("offerDetails",{url:"/offer_details/:product_name",templateUrl:"https://cdn.esewa.com.np/ui/html/offers/user/offer_details.html",controller:"OfferDetailController"})}])}(),function(){angular.module("esewaCustomerApp").config(["$httpProvider","datepickerConfig",function(a,b){b.showWeeks=!1,a.interceptors.push(["$rootScope","$q","AUTH_EVENTS","CDNUrl","ecmsg","$cookies",function(a,b,c,d,e,f){return{request:function(b){if(!angular.isDefined(a.isLoggedIn))return b;if(_.includes(b.url,d.url))_.includes(b.url,"/documents")&&_.includes(b.url,".jpg")&&(b.headers.CacheControl="no-cache");else if(a.isLoggedIn()&&(_.includes(b.url,"/auth")||_.includes(b.url,"/logout")||_.includes(b.url,"/airlines"))){var c=f.get("authesewa");c&&(b.headers.uuid=c.split(":")[1])}return a.disableSubmit=!0,b},response:function(b){return a.disableSubmit=!1,b},responseError:function(d){a.disableSubmit=!1;var f=d.status;if(!_.includes(d.config.url,"reg")&&!_.includes(d.config.url,"authenticate")&&!_.includes(d.config.url,"forgot_password")){if(a.message={error:""},401===f||403===f)a.$broadcast(c.notAuthorized),a.message.error&&(_.includes(d.config.url,"payment_menus")||_.includes(d.config.url,"/products/showcase")||e.error(a.message.error,""));else if(500===f)return e.error("Sorry, something went wrong.",""),b.reject(d);""!==a.message.error&&angular.isDefined(a.message.error)&&(a.message.error?(e.error(a.message.error,""),document.body.scrollTop=document.documentElement.scrollTop=0):angular.isDefined(d.data.error_message)&&(_.includes(d.config.url,"make_payment")||_.includes(d.config.url,"payment")||_.includes(d.config.url,"validate")?a.message.error=d.data.error_message:_.includes(d.config.url,"payment_menus")||_.includes(d.config.url,"/products/showcase")||e.error(d.data.error_message,"")))}return b.reject(d)}}}])}])}(),function(){angular.module("esewaCustomerApp").controller("AuthController",["$scope","$rootScope","$state","AuthService","$http","AUTH_EVENTS","$timeout","$filter","ecmsg","ValidationService","StateConstant","$modal","$location","CDNUrl","$q","$window","$localStorage","$base64",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(a,b,c,d,e){this.esewaId=a,this.username=b,this.isPrimary=c,this.lastLoggedIn=d,this.isVerified=e}function t(a){var b=o.defer(),c=new Image;return c.onerror=function(){b.resolve(!1)},c.onload=function(){b.resolve(!0)},c.src=a,b.promise}b.clearMessage(),b.showApplicationProcessing=!1;var u="Invalid username or password";a.FocusLogin=!0,b.login=function(d){return b.error={},j.checkUsernameValid(d.esewaId)?d.password?void e({method:"POST",url:"/authenticate",headers:{esewa_id:d.esewaId,password:r.encode(d.password)},data:""}).success(function(a){console.log(a),a?p.location.href=a.location:p.location.reload()}).error(function(a){b.loginErrorSHow=!0,a?a.set_password?(b.passwordDto={esewaId:d.esewaId},i.info(a.set_password),c.go("authentication.setPassword")):a.error_message?b.loginError=a.error_message:b.loginError=u:b.loginError=u,g(function(){b.loginErrorSHow=!1},3e4)}):(b.loginError="Invalid Password",b.loginErrorSHow=!0,g(function(){b.loginErrorSHow=!1},2e3),!1):(b.loginError="Invalid eSewa ID",b.loginErrorSHow=!0,g(function(){b.loginErrorSHow=!1},2e3),console.log(a.loginError),!1)},b.afterLogin=function(){g(function(){angular.element("#proceedPayment").trigger("click")},0),b.showApplicationProcessing=!0,c.current.name.startsWith("static")||c.current.name.startsWith("login")||c.current.name.startsWith("authentication")||c.current.name.startsWith("activate")?b.targetLogin?c.go(k.MAKE_PAYMENT,{product_code:b.targetLogin,product_name:b.targetLogin},{reload:!0}):c.current.name.startsWith("activate")||c.go(k.HOME_MAIN):(b.currentModal&&b.currentModal.dismiss(),b.targetLogin=m.absUrl()),d.getUserProfile().then(function(c){if(b.isAuthenticated()&&b.$broadcast(f.getBalanceAndRewards),angular.isDefined(c)){var d=h("date");b.$storage.profile=new s(c.esewa_id,c.username,c.is_primary,d(c.last_logged_in,"yyyy-MM-dd HH:mm:ss"),c.is_verified),b.$broadcast(f.socket),b.targetLogin||a.getInitialRequirement(),g(function(){a.getProfileImage(),b.showApplicationProcessing=!1},1e3),a.checkUserStatus()}else b.showApplicationProcessing=!1},function(){b.showApplicationProcessing=!1})},a.checkUserStatus=function(){q.status||e({method:"GET",url:"/api/web/auth/user/status"}).success(function(){q.status="done"}).error(function(a){q.status="done",i.error(a.error_message)})},a.getInitialRequirement=function(){b.isAuthenticated()&&d.getInitialRequirements().then(function(c){b.initialRequirement={},c?(a.response=c.plain(),b.initialRequirement={form:a.response.required_form,url:a.response.form_url,type:a.response.required_type},b.$broadcast(f.initialRequirement)):(b.showApplicationProcessing=!1,b.$broadcast(f.loginSuccess))},function(){b.showApplicationProcessing=!1})},a.getInitialRequirement(),b.openLoginDialog=function(a){return l.open({templateUrl:"/user/authentication/views/login_dialog.html",controller:"LoginPopupController",size:"login",backdrop:"static",keyboard:!1,resolve:{loginData:function(){return a}}})},a.getProfileImage=function(){var b=document.querySelector("#ACCOUNT_ICON");b&&(b.src=a.getUserIcon()),e({method:"GET",url:"/api/web/auth/kyc/document/download",headers:{"Content-Type":void 0,uuid:e.defaults.headers.common.uuid},data:""}).success(function(b){b.file_name&&g(function(){var c=document.querySelector("#ACCOUNT_ICON");c&&(c.src="",t(b.file_name).then(function(d){d===!0?c.src=b.file_name:c.src=a.getUserIcon()}))},500)}).error(function(){g(function(){b&&(b.src=a.getUserIcon())},500)})},a.getUserIcon=function(){return n.defaultAccountUrl}}])}(),function(){angular.module("esewaCustomerApp").service("AuthService",["Restangular",function(a){var b=a.all("auth"),c=a.all("esewa");this.authenticate=function(b){return a.one("authenticate").customPOST("","","",{esewa_id:b.esewaId,password:b.password})},this.registerUserUsingEsewaId=function(a,b){var d={esewa_id:a.esewaId,email:a.email,"g-recaptcha-response":b,terms_and_conditions:a.termsAndCondition};return c.all("reg").post(d)},this.validateToken=function(a){return c.one(a.esewaId+"").one("token").one(a.token+"").one("validate").customGET()},this.validateLastToken=function(a){return c.one(a.esewaId+"").one("token").one(a.token+"").one("validate").customGET()},this.changePassword=function(a){return b.one("change_password").customPUT("","","",{old_password:a.oldPassword,new_password:a.newPassword})},this.setPassword=function(a){var b={token:a.token};return c.one(a.esewaId+"").one("create_password").customPOST(b,"","",{password:a.password})},this.getInitialRequirements=function(){return b.one("initial_requirements").get()},this.getUserProfile=function(){return b.one("profile").customGET()},this.logout=function(b){return a.all("logout").customPOST("","","",{esewa_id:b})},this.getCaptchaServerCode=function(){return a.one("captcha_server_code").customGET()}}])}(),function(){angular.module("esewaCustomerApp").controller("LoginPopupController",["$rootScope","$scope","loginData","$state","$modalInstance","$timeout",function(a,b,c,d,e,f){b.cancel=function(){e.dismiss(),d.go("main.landing")},c&&(a.loginData=c.loginData),a.currentModal=e,b.login=function(b){a.login(b),f(function(){a.isLoggedIn()&&e.dismiss()},2e3)}}])}(),function(){angular.module("esewaCustomerApp").controller("EmailActivationController",["$scope","$rootScope","$state","$stateParams","EmailActivationService","ecmsg","$sce","INFORMATION","InformationService","$timeout","EmailNotificationService","StateConstant","AUTH_EVENTS",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.token=d.token,a.currentState=c.current.name;var n="";a.esewaId="",b.message.error="",b.targetLogin="","activate.setPasswordForEmailUser"===a.currentState&&e.getUserTokenActivation(a.token,"USER_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username,a.showToken=!1)},function(){f.error("Activation link is either invalid or expired !!",""),c.go("login")}),"activate.setPasswordForPrimaryUser"===a.currentState?e.getUserTokenActivation(a.token,"USER_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username,a.showToken=!0,e.sendPrimaryUserToken(a.esewaId,a.token).then(function(b){a.response=b.plain(),a.token=""},function(){}))},function(){f.error("Activation link is either invalid or expired !!",""),c.go("login")}):"activate.setForgottenPassword"===a.currentState?e.getUserTokenActivation(a.token,"FORGET_PASSWORD").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username),n=h.forgotPasswordValidation},function(){f.error("Activation link is either invalid or expired !!",""),c.go("login")}):"activateNotification"===a.currentState&&(b.isAuthenticated()?(a.notificationDto={token:a.token},e.getUserTokenActivation(a.token,"NOTIFICATION_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username)},function(){f.error("Activation link is either invalid or expired !!",""),c.go("login")})):(f.error("You must be logged in for this operation or open this link from logged in browser!!",""),c.go("login"))),a.password={password:"",confirm_password:""},a.validateToken=function(b,d){a.userInfo={token:b,notificationId:d},k.validateToken(a.userInfo).then(function(b){a.validationInfo=b.plain(),a.showValidateUser=!1,j(function(){f.success("Notification ID is activated",""),c.go(l.NOTIFICATIONS)},300)},function(a){angular.isDefined(a)&&(a.data?f.error(a.data.error_message,""):f.error("Service is currently unavailable. please, try again later",""),c.go(l.LOGIN))})},a.setPasswordForEmailUser=function(){(a.esewaId||a.passwordDto.mobileToken||"activate.setPasswordForPrimaryUser"!==a.currentState)&&(a.tokenDto={token:a.token,mobileToken:a.passwordDto.mobileToken},a.passwordDto.newPassword===a.passwordDto.confirmNewPassword?e.setPasswordForEmailUser(a.esewaId,a.tokenDto,a.passwordDto).then(function(b){f.success(b.plain().message,""),a.loginDto={esewaId:a.esewaId,password:a.passwordDto.newPassword},c.go("login"),a.disableSubmit=!1},function(b){a.disableSubmit=!1,angular.isDefined(b.data.error_message)?f.error(b.data.error_message,""):f.error("Invalid Request !!","")}):f.error("Please, Check your password !!",""))},a.setNewForgottenPassword=function(){a.setPasswordDto={token:a.token,password:a.passwordDto.password},e.setNewForgottenPassword(a.esewaId,a.setPasswordDto).then(function(a){f.success(a.plain().message,""),c.go("login")},function(){f.error("Invalid Request !!","")})},a.addNotification=function(){return b.isLoggedIn?void a.validateToken(a.token,a.esewaId):void f.error("You must be logged in for this operation.","")},a.checkPassword=function(){return a.password.password===a.password.confirm_password},a.cancel=function(){c.go("login")},a.showInformation=!1,n&&(b.informationKey=n,b.$broadcast(m.information))}])}(),function(){angular.module("esewaCustomerApp").service("EmailActivationService",["Restangular",function(a){this.getUserTokenActivation=function(b,c){var d=_.merge({activation_type:c},{token:b});return a.one("token").one("validate").get(d)},this.setPasswordForEmailUser=function(b,c,d){var e={token:c.token};return c.mobileToken&&(e.token=c.mobileToken),a.one("esewa").one(b+"").one("create_password").customPOST(e,"","",{password:d.newPassword,username:d.username})},this.setNewForgottenPassword=function(b,c){return a.one(b+"").one("forgot_password").customPUT(c)},this.resendNotification=function(b,c){var d={type:b,notification_id:c};return a.one("auth").one("token").one("resend").customPUT(d)},this.sendPrimaryUserToken=function(b,c){var d={esewa_id:b,token:c};return a.one("auth").one("verify_email").customPOST(d)}}])}(),function(){angular.module("esewaCustomerApp").service("EmailNotificationService",["Restangular",function(a){var b=a.all("auth").one("notification");this.addNotification=function(a){return b.customPOST(a)},this.validateToken=function(a){var c={token:a.token,notification_id:a.notificationId};return b.customPUT(c)}}])}(),function(){angular.module("esewaCustomerApp").controller("UserProfileController",["$scope","$rootScope","$state","$timeout","KycService","$http","AddressService","PropertyConstant","LabelConstant","ecmsg","InformationService","INFORMATION","$sce","$location","$anchorScroll","$modal","FileSaverFactory","ValidationService","CDNUrl","MessageConstant","StateConstant",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){a.showloadingBar=!1,a.MessageConstant=t,a.LabelConstant=i,b.showApplicationProcessing=!1;a.formDataDoc=new FormData,a.isFileUploaded=!1,a.documentType="CTZN",a.image="",a.message="",a.documentName="",a.title="",a.uploads=0,a.isPhotoUploaded=!1,a.isDocumentFirstUploaded=!1,a.isDocumentSecondUploaded=!1,a.getGenderCode=function(a){switch(a){case"MALE":return"M";case"FEMALE":return"F";case"N/A":return"0"}},a.validateKycFirst=function(b){return!!(b&&b.permanent_address&&b.current_address)&&(r.checkDOBValid(b.date_of_birth_bs)&&b.sex&&r.checkToleValid(b.permanent_address.tole)&&r.checkToleValid(b.current_address.tole)&&r.checkWardValid(b.permanent_address.ward_number)&&r.checkWardValid(b.current_address.ward_number)&&r.checkNameValid(b.full_name,!1)&&r.checkLandlineValid(b.land_line_number)&&r.checkNameValid(b.father_name,!1)&&r.checkNameValid(b.grand_father_name,!1)&&a.selectedOccupation.id)},a.editorEnabled=!1,a.copyToCurrentAddress=function(){a.sameAsPermanent&&(a.selectedCurrentZone=a.selectedPermanentZone,a.selectedCurrentDistrict=a.selectedPermanentDistrict,a.currentDistricts=a.permanentDistricts,a.currentVdcs=a.permanentVdcs,a.personalDetails.current_address={address_id:a.personalDetails.permanent_address.address_id,ward_number:a.personalDetails.permanent_address.ward_number,tole:a.personalDetails.permanent_address.tole},a.personalDetails.current_address.address_id=a.personalDetails.permanent_address.address_id,a.currentVdc=a.permanentVdc,a.sameAsPermanent=!0)},a.getUserAddress=function(){a.zoneList||a.setAddress()},a.identityDetailEditorEnable=function(){},a.addUpdatePersonalInformation=function(c){var d=r.separateNames(c.full_name);c.first_name=d[0],c.middle_name=d[1],c.last_name=d[2],c.sex=a.getGenderCode(c.sex),c.occupation_id=a.selectedOccupation.id,c.occupation=a.selectedOccupation.name,
c.current_address={address_id:a.currentVdc.id,ward_number:c.current_address.ward_number,tole:c.current_address.tole},c.permanent_address={address_id:a.permanentVdc.id,ward_number:c.permanent_address.ward_number,tole:c.permanent_address.tole},b.initialRequirement.form!==h.kycPersonalDetail?a.addUpdatePersonalDetails(c,!0):a.addUpdatePersonalDetails(c,!1)},a.showPermanentDistricts=function(b){a.permanentVdcs="",a.sameAsPermanent=!1,b&&(b!==a.selectedCurrentZone?g.getDistrict(b.id).then(function(b){a.permanentDistricts=b.plain()}):a.permanentDistricts=a.currentDistricts)},a.showPermanentVDC=function(b){a.sameAsPermanent=!1,b&&(b!==a.selectedCurrentDistrict?g.getVdcs(b.id).then(function(b){a.permanentVdcs=b.plain()}):a.permanentVdcs=a.currentVdcs)},a.setChangePermanentVDC=function(){a.sameAsPermanent=!1},a.setChangeCurrentVDC=function(){a.sameAsPermanent=!1},a.setChangeWard=function(){a.sameAsPermanent=!1},a.setChangeTole=function(){a.sameAsPermanent=!1},a.showCurrentDistricts=function(b){b&&(b!==a.selectedPermanentZone?g.getDistrict(b.id).then(function(b){a.currentDistricts=b.plain()}):a.currentDistricts=a.permanentDistricts)},a.showCurrentVDC=function(b){b?b!==a.selectedPermanentDistrict&&g.getVdcs(b.id).then(function(b){a.currentVdcs=b.plain()}):a.currentVdcs=a.permanentVdcs},a.cancelUpdate=function(){a.deleteInitialRequirementCondition(),d(function(){c.reload()},500),c.go(u.KYC_DETAIL)},a.confirmPersonalDetails=function(b,c,d,e,f,g,h,i){a.openConfirmPersonalDetailDialog(b,c,d,e,f,g,h,i)},a.openConfirmPersonalDetailDialog=function(b,c,d,e,f,g,h,i){p.open({templateUrl:"/user/userkyc/views/confirm_personal_detail.html",controller:"ConfirmPersonalDetailController",size:"md",resolve:{personalDetails:function(){return b},permanentZone:function(){return c},permanentDistrict:function(){return d},permanentVdc:function(){return e},currentZone:function(){return f},currentDistrict:function(){return g},currentVdc:function(){return h},occupationName:function(){return i},finalSubmitFunction:function(){return a.addUpdatePersonalInformation}}})},a.deleteInitialRequirementCondition=function(){a.showSkipKycTwo=!1,a.showSkipKycThree=!1,b.initialRequirement.type="skipped",a.showSkipAndNeverSeeKycTwo=!1,a.showSkipAndNeverSeeKycThree=!1,a.hideCancelKycTwo=!1,a.hideCancelKycThree=!1},a.skipDetails=function(d){a.deleteInitialRequirementCondition(),e.skipInitialRequirement(d).then(function(b){a.neverSeeThisAgain=b.plain(),c.go(u.HOME_MAIN)},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?b.message.error=a.data.error_message:b.message.error="Error occurred while serving your request. Please, try again later.")})},a.neverSeeAgain=function(d){a.deleteInitialRequirementCondition(),e.setNeverSeeThisAgain(d).then(function(b){a.neverSeeThisAgain=b.plain(),c.go(u.HOME_MAIN)},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?b.message.error=a.data.error_message:b.message.error="Error occurred while serving your request. Please, try again later.")})}}])}(),function(){angular.module("esewaCustomerApp").controller("AbstractUserController",["$scope","$rootScope","$state","$timeout","KycService","$http","AddressService","PropertyConstant","LabelConstant","ecmsg","InformationService","INFORMATION","$sce","$location","$anchorScroll","$modal","FileSaverFactory","ValidationService","CDNUrl","MessageConstant","StateConstant","$window","PropertyOrderFactory","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){function y(){a.load=!1,b.loading=!1,a.documentCount=a.documentCount-1,a.documentCount<1&&d(function(){a.reloadPage(),c.go(u.KYC_DETAIL)},2e3)}function z(e){e?(b.loading=!0,a.isDataUploaded=!1,a.photoUploadComplete=!0,a.uploads=a.uploads+1,f({method:"POST",url:"/api/web/auth/kyc/upload/document",headers:{"Content-Type":void 0,file_type:"CTZN"},data:e}).then(function(){b.loading=!1,d(function(){j.success("Documents uploaded successfully",""),c.go(u.KYC_DETAIL,{},{reload:!0})},100)},function(a){angular.isDefined(a.data.error_message)?null!==a.data.error_message&&j.error(a.data.error_message,""):j.error("Failed to upload citizenship",""),y()})):d(function(){j.success("Image uploaded successfully",""),c.go(u.KYC_DETAIL,{},{reload:!0})},100),a.load=!1}function A(c,d){c?f({method:"POST",url:"/api/web/auth/kyc/upload/document",headers:{"Content-Type":void 0,file_type:"IMAGE"},data:c}).then(function(){z(d)},function(c){b.loading=!1,a.load=!1,a.disableSubmit=!1,a.isDataUploaded=!1,a.uploadDisable=!1,angular.isDefined(c.data.error_message)?null!==c.data.error_message&&j.error(c.data.error_message,""):j.error("Failed to upload image",""),y()}):z(d)}function B(b,c){var d=b.size,e=b.name.replace(/^.*[\\\/]/,"");(d>1024e3||d<1024)&&(e="File size is not valid"),0===c?a.photoTitle=e:1===c?a.ctznTitle+=e:a.ctznbkTitle+=e}a.showloadingBar=!0,a.load=!1,b.loading=!1,a.kycStatus="",a.PropertyConstant=h,a.genders=["MALE","FEMALE","N/A"],a.genders[0]="MALE",b.clearMessage(),a.isPrimaryUser=!0,a.documentType="CTZN",a.PropertyConstant=h,a.MessageConstant=t,a.LabelConstant=i,b.showApplicationProcessing=!1,a.formDataDoc=new FormData,a.isFileUploaded=!1,a.image="",a.message="",a.documentName="",a.title="",a.uploads=0,a.isPhotoUploaded=!1,a.isDocumentFirstUploaded=!1,a.isDocumentSecondUploaded=!1,a.disableSubmit=!1,a.reload=function(a){a?(b.deleteInitialRequirementCondition(),c.go(u.HOME_MAIN)):c.go(u.KYC_DETAIL,{},{reload:!0})},a.reloadPage=function(){c.go(u.KYC_DETAIL,{},{reload:!0})},a.uploadNew=function(a){formDataDoc="",$("#"+a+"_in").click()},a.uploadDocToServer=function(b,c,d){a.formDataDoc=[],d=d.replace("_in","");var e=b[0].size;if(e<h.kycDocumentUploadMaxSize&&e>h.kycDocumentUploadMinSize){a.formDataDoc.push(b[0]),B(b[0],0);var f=new FileReader;f.onload=function(a){angular.element("#"+d).attr("src",a.target.result),angular.element("#btn"+d).removeClass("hide")},f.readAsDataURL(c.files[0]),a.hidePhotoUpload=!1}else j.error("Image size must be less than 10 MB",""),a.image_photo="",a.isPhotoUploaded=!0,a.$apply()},a.setKycData=function(){a.kycDetails&&(a.loadingBar=!1,a.personalDetail=a.kycDetails.personal_resource,a.userFiles=a.kycDetails.identification_resource,a.kycStatus=a.kycDetails.status,a.existingPersonalDetails=a.personalDetails,a.kycStatus===h.kycStatusRejected&&(b.verificationRejectedMessage="Verification request is rejected."),a.personalDetail&&(a.selectedOccupation={id:a.personalDetail.occupation_id,occupation_name:a.personalDetail.occupation}),a.kycStatus!==h.kycStatusApproved&&a.kycStatus!==h.kycStatusCancelVerification?(a.personalDetail&&a.personalDetail.status!==h.kycStatusAccepted&&(a.personalDetailEditorEnabled=!0),a.userFiles&&a.userFiles.document_status!==h.kycStatusAccepted&&(a.identityDetailEditorEnabled=!0),a.hidePhotoEdit=!1):c.go(u.KYC_DETAIL),a.kycStatus===h.kycStatusSubmitVerification&&(a.showSubmitForVerification=!0),a.kycStatus===h.kycStatusCancelVerification&&(a.showCancelVerification=!0,a.personalDetailEditorEnabled=!1,a.identityDetailEditorEnabled=!1),a.getCitizenshipCount()>0&&(a.hideCtznUpload=!0),a.getCitizenshipCount()>1&&(a.hideCtznBackUpload=!0),a.getPhotoCount()>0&&(a.hidePhotoUpload=!0),c.current.name===u.KYC_THREE&&a.hideCtznUpload&&a.hidePhotoUpload&&c.go(u.KYC_DETAIL),a.getProfilePic())},a.getInformationMessage=function(c){k.getInformation(c).then(function(c){b.information=c.plain(),b.information.information&&(a.showInformation=!0),b.trustedHtml=m.trustAsHtml(b.information.information)})},a.getCitizenshipCount=function(){var b=0;return a.userFiles&&a.userFiles.forEach(function(a){a.document_type===h.kycDocumentCodeCtzn&&b++}),b},b.$storage.profile&&(a.isPrimaryUser=b.$storage.profile.isPrimary),d(function(){c.current.name===u.KYC_ONE&&a.getEditablePersonalDetails(),a.getInitialButtonCondition()},100),a.getInitialButtonCondition=function(){d(function(){b.initialRequirement&&(b.initialRequirement.form===h.kycPersonalDetail?b.initialRequirement.type===h.initialSkip?(a.showSkipKycOne=!0,a.hideCancelKycOne=!0):b.initialRequirement.type===h.initialSkipAndNeverSee?(a.showSkipAndNeverSeeKycOne=!0,a.showSkipKycOne=!0,a.hideCancelKycOne=!0):b.initialRequirement.type===h.initialForceful&&(a.hideCancelKycOne=!0):b.initialRequirement.form===h.kycIdentityDetail&&(b.initialRequirement.type===h.initialSkip?(a.showSkipKycThree=!0,a.hideCancelKycThree=!0):b.initialRequirement.type===h.initialSkipAndNeverSee?(a.showSkipAndNeverSeeKycThree=!0,a.showSkipKycThree=!0,a.hideCancelKycThree=!0):b.initialRequirement.type===h.initialForceful&&(a.hideCancelKycThree=!0)))},0)},a.getIconForStatus=function(a){switch(a){case"REJECTED":return"/common/icons/user/kyc_rejected.png";case"ACCEPTED":return"/common/icons/user/kyc_approved.png";case"APPROVED":return"/common/icons/user/kyc_approved.png";default:return"/common/icons/user/kyc_pending.png"}},a.goToCategoryOne=function(){a.personalDetails="",a.getEditablePersonalDetails(),c.go(u.KYC_ONE)},a.addUpdatePersonalDetails=function(f,g){e.addUpdatePersonalDetails(f,g).then(function(e){a.successResponse=e.plain(),a.successResponse.message&&d(function(){b.successMessageForIndex=!0,b.message.success=a.successResponse.message,j.success(b.message.success,"")},100),b.personalDetailEditorEnabled=!1,g?(d(function(){c.reload()},100),c.go(u.KYC_DETAIL,{},{reload:!0})):(b.initialRequirement={},c.go(u.KYC_THREE))},function(d){if(b.showInformation=!1,angular.isDefined(d))if(b.errorMessageForIndex=!0,d.data.error_message)a.responseMessage=d.data.error_message;else if(d.data.error_message){a.responseMessage=d.data.error_message;for(var e in d.data.field_message){var f=d.data.field_message[e];r.showRejectedField("personalDetails",e,f)}}else a.responseMessage="Error occurred while updating personal information. Please, try again later.";else c.go(u.KYC_DETAIL,{},{reload:!0});a.editorEnabled=!1,a.getEditablePersonalDetails()})},a.getKycDetails=function(){a.showloadingBar=!0,(c.current.name===u.KYC_DETAIL||a.reload)&&(a.reload=!1,e.getKyc().then(function(b){a.kycDetails=b.plain(),a.setKycData(),a.showloadingBar=!1},function(c){b.message.error="Request cannot be processed right now. Please, Try again later!!!",a.showloadingBar=!1}))},a.getEditablePersonalDetails=function(){a.personalDetails||(d(function(){a.occList||a.setOccupation()}),a.selectedOccupation={},d(function(){a.setPersonalDetailFields()},100))},a.setOccupation=function(){e.getOccupation().then(function(b){a.occList=w.orderOccupation(b.plain())},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?j.error(a.data.error_message):j.error("Error in obtaining some information. Please try again later.")),c.go(u.KYC_DETAIL)})},a.setPersonalDetailFields=function(){e.getEditablePersonalDetails().then(function(b){d(function(){a.editorEnabled=!0,a.personalDetails=b.plain(),a.personalDetails.sex=x("gender")(a.personalDetails.sex),a.middleName="",a.personalDetails.middle_name&&(a.middleName=a.personalDetails.middle_name.length>0?a.personalDetails.middle_name+" ":""),a.personalDetails.first_name&&(a.personalDetails.full_name=a.personalDetails.first_name+" "+a.middleName+a.personalDetails.last_name),a.personalDetails.permanent_address&&_.isEqual(a.personalDetails.permanent_address,a.personalDetails.current_address)&&(a.sameAsPermanent=!0),a.setAddress(),a.personalDetails.occupation_id&&a.occList&&(a.selectedOccupation={id:_.filter(a.occList,{id:a.personalDetails.occupation_id})[0].id,occupation_name:a.personalDetails.occupation})},100)},function(c){b.showInformation=!1,a.setAddress(),angular.isDefined(c)&&(c.data?b.message.error=c.data:b.message.error=t.dataFetchError)},function(){a.setAddress()})},a.setAddress=function(){g.getZones().then(function(b){a.zoneList=b.plain(),a.personalDetails&&(a.personalDetails.permanent_address&&(a.selectedPermanentZone=_.filter(a.zoneList,{id:a.personalDetails.permanent_address.zone_id})[0],a.selectedPermanentZone&&a.setDistrict(a.selectedPermanentZone.id,!0)),a.personalDetails.current_address&&(a.selectedCurrentZone=_.filter(a.zoneList,{id:a.personalDetails.current_address.zone_id})[0],a.selectedCurrentZone&&a.setDistrict(a.selectedCurrentZone.id,!1)))})},a.setDistrict=function(b,c){g.getDistrict(b).then(function(b){c&&b.plain()?(a.permanentDistricts=b.plain(),a.selectedPermanentDistrict=_.filter(a.permanentDistricts,{id:a.personalDetails.permanent_address.district_id})[0],a.selectedPermanentDistrict&&a.setVDC(a.selectedPermanentDistrict.id,!0)):b.plain()&&(a.currentDistricts=b.plain(),a.selectedCurrentDistrict=_.filter(a.currentDistricts,{id:a.personalDetails.current_address.district_id})[0],a.selectedCurrentDistrict&&a.setVDC(a.selectedCurrentDistrict.id,!1))})},a.setVDC=function(b,c){g.getVdcs(b).then(function(b){c?(a.permanentVdcs=b.plain(),a.permanentVdc=_.filter(a.permanentVdcs,{id:a.personalDetails.permanent_address.vdc_municipality_id})[0],a.personalDetails.permanent_address&&a.personalDetails.current_address&&a.personalDetails.permanent_address.zone_id!==a.personalDetails.current_address.zone_id?a.setDistrict(a.selectedCurrentZone.id,!1):(a.currentDistricts=a.permanentDistricts,a.personalDetails.permanent_address&&a.personalDetails.current_address&&(a.selectedCurrentDistrict=_.filter(a.currentDistricts,{id:a.personalDetails.current_address.district_id})[0],a.personalDetails.permanent_address.district_id!==a.personalDetails.current_address.district_id?a.setVDC(a.selectedCurrentDistrict.id,!1):(a.currentVdcs=a.permanentVdcs,a.currentVdc=a.permanentVdc)))):(a.currentVdcs=b.plain(),a.currentVdc=_.filter(a.currentVdcs,{id:a.personalDetails.current_address.vdc_municipality_id})[0])})},a.submitOrCancelVerification=function(f){var g=h.kycStatusSubmitVerification;f||(g=h.kycStatusCancelVerification),e.submitForVerification(g).then(function(e){a.successResponse=e.plain(),a.successResponse.message&&d(function(){b.successMessageForIndex=!0,b.message.success=a.successResponse.message},300),d(function(){c.reload()},100)},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?b.message.error=a.data.error_message:b.message.error="Error occurred while updating personal information. Please, try again later.")})},a.getPhotoCount=function(){var b=0;return a.userFiles&&a.userFiles.forEach(function(a){a.document_type===h.kycDocumentCodePhoto&&b++}),b},a.deleteInitialRequirementCondition=function(){a.showSkipKycTwo=!1,a.showSkipKycThree=!1,a.showSkipAndNeverSeeKycTwo=!1,a.showSkipAndNeverSeeKycThree=!1,a.hideCancelKycTwo=!1,a.hideCancelKycThree=!1},a.gotoCategoryThree=function(){a.userFiles=[],a.deleteInitialRequirementCondition(),c.go(u.KYC_THREE)},a.getDocumentStatusName=function(a){switch(a){case"REJECTED":return"Rejected";case"ACCEPTED":return"Approved";case"APPROVED":return"Approved";case"SUBMIT_VERIFICATION_REQUEST":return"Verification Request Submitted";case"CANCEL_VERIFICATION_REQUEST":return"Verification Request Cancelled";case"PENDING":return"Pending";default:return""}},a.getImageSrc=function(a){d(function(){return a?a:s.defaultAccountUrl},2e3)},a.uploadAndSetPreview=function(b,c,d){if(d===h.kycDocumentCodeCtzn&&!(b.length>0&&b.length<3-a.getCitizenshipCount()))return j.error("Invalid number of upload documents",""),void(a.disableSubmit=!0);var e=b[0].size;if(a.ctznTitle="",e<h.kycDocumentUploadMaxSize&&e>h.kycDocumentUploadMinSize){d===h.kycDocumentCodeCtzn?a.fdctzn=[]:"CTZN_BACK"===d?a.fdctznbk=[]:a.fdimg=[];for(var f=0;f<b.length;f++)d===h.kycDocumentCodeCtzn&&(a.fdctzn.push(b[f]),B(b[f],1)),"CTZN_BACK"===d&&(a.fdctznbk.push(b[f]),B(b[f],2)),d===h.kycDocumentCodePhoto&&(a.fdimg.push(b[f]),B(b[0],0)),a.$apply();a.currentFile=c.files[0];var g=new FileReader;g.onload=function(b){d===h.kycDocumentCodeCtzn?a.image_ctzn_1=b.target.result:"CTZN_BACK"===d?a.image_ctzn_2=b.target.result:d===h.kycDocumentCodePhoto&&(a.image_photo=b.target.result),a.$apply()},g.readAsDataURL(c.files[0]),c.files.length>1&&(g=new FileReader,g.onload=function(b){a.image_ctzn_2=b.target.result,a.$apply()},g.readAsDataURL(c.files[1])),a.isDocumentFirstUploaded=!0,a.disableSubmit=!1}else j.error("Image size must be less than 10 MB",""),a.image_ctzn_1="",a.disableSubmit=!0,a.isDocumentFirstUploaded=!1,a.$apply()},a.uploadImageTask=function(){var b,c;a.uploadingFile=!0,a.documentCount=0,angular.isDefined(a.fdimg)&&(a.documentCount=a.documentCount=1),angular.isDefined(a.fdctzn)&&(a.documentCount=a.documentCount=+a.fdctzn.length),(a.fdctzn||a.fdctznbk)&&(c=new FormData,a.fdctzn&&c.append("file",a.fdctzn[0]),a.fdctznbk&&c.append("file",a.fdctznbk[0])),a.fdimg&&(b=new FormData,b.append("file",a.fdimg[0])),A(b,c)},a.disableSelect=function(){a.disableSubmit=!0},a.forCancel=function(){d(function(){a.disableSubmit=!1},500)},a.uploadFileToServer=function(){a.load=!1,b.loading=!1,a.isDataUploaded=!1,a.uploadDisable=!0,a.disableSubmit=!0,a.uploadImageTask(),a.fdimg=[],a.fdctzn=[],a.fdctznbk=[]},a.goToKycDetail=function(){b.loading=!1,c.reload(u.KYC_DETAIL)},a.uploadAndReplaceFileInServer=function(c){b.loading=!0,a.isDataUploaded=!1;var e=new FormData;e.append("file",a.formDataDoc[0]),f({method:"POST",url:"/api/web/auth/kyc/upload/document/"+c,headers:{"Content-Type":void 0},data:e}).then(function(){b.loading=!1,a.isDocumentFirstUploaded=!0,j.success("Image uploaded successfully",""),a.userFiles={},d(function(){a.userFiles=a.kycDetails.identification_resource,a.reloadPage(),a.$apply(),b.loading=!1},1e3)},function(c){b.loading=!1,a.isDocumentFirstUploaded=!1,b.loading=!1,""!==c.data.error_message?j.error(c.data.error_message,""):j.error("Failed to upload document","")})},a.goToDetail=function(){a.reload=!1,c.go(u.KYC_DETAIL)},a.uploadPhotoToServer=function(b,c){return a.disableSubmit=!0,0===b.length?void(a.disableSubmit=!1):void a.uploadAndSetPreview(b,c,h.kycDocumentCodePhoto)},a.uploadCtznToServer=function(b,c){return a.disableSubmit=!0,0===b.length?void(a.disableSubmit=!1):void a.uploadAndSetPreview(b,c,h.kycDocumentCodeCtzn)},a.uploadCtznBackToServer=function(b,c){return a.disableSubmit=!0,0===b.length?void(a.disableSubmit=!1):void a.uploadAndSetPreview(b,c,"CTZN_BACK")},a.getFileName=function(a){return a.replace(".esewa","")},a.photoTitle="",a.ctznTitle="",a.goToCategoryAll=function(){a.reload=!1,c.go(u.KYC_DETAIL)},a.neverSeeAgain=function(d){a.deleteInitialRequirementCondition(),e.setNeverSeeThisAgain(d).then(function(b){a.neverSeeThisAgain=b.plain(),c.go(u.HOME_MAIN)},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?b.message.error=a.data.error_message:b.message.error="Error occurred while serving your request. Please, try again later.")})},a.getDisplayDocumentType=function(a){return"CTZN"===a?"Citizenship":"User Photo"},c.current.name===u.KYC_TWO&&(a.editor2Enabled=!0),a.skipIdentityDetail=function(){c.go(u.HOME_MAIN)},a.showImageInPopup=function(a){p.open({templateUrl:"/user/userkyc/views/model_image.html",size:"md kyc-image-modal",controller:"ImagePopupController",resolve:{image_src:function(){return document.querySelector("#"+a.document_type+"_"+a.identification).src},doc:function(){return a}}})},a.getImageSrc=function(a){return a?a:s.defaultAccountUrl},a.profilePic={},a.getProfilePic=function(){for(var b in a.userFiles)"IMAGE"===a.userFiles[b].document_type&&(a.profilePic=a.userFiles[b])}}])}(),function(){angular.module("esewaCustomerApp").filter("randomSrc",function(){return function(a){if(a)return a+"?r="+Math.round(999999*Math.random())}})}(),function(){angular.module("esewaCustomerApp").controller("ConfirmPersonalDetailController",["$rootScope","$scope","personalDetails","$modalInstance","permanentZone","permanentDistrict","permanentVdc","currentZone","currentDistrict","currentVdc","occupationName","finalSubmitFunction",function(a,b,c,d,e,f,g,h,i,j,k,l){b.confirmationDetail=c,b.occupationName=k,b.cancel=function(){d.dismiss()},b.permanentAddress=b.confirmationDetail.permanent_address.tole+", "+g+" - "+b.confirmationDetail.permanent_address.ward_number+", "+f+", "+e,b.temporaryAddress=b.confirmationDetail.current_address.tole+", "+j+" - "+b.confirmationDetail.current_address.ward_number+", "+i+", "+h,b.submitRequest=l,b.cancelConfirmation=function(){d.close()},a.currentModal=d}])}(),function(){angular.module("esewaCustomerApp").service("KycService",["Restangular",function(a){var b=a.all("auth");this.addUpdatePersonalDetails=function(a,c){return c?b.all("kyc").all("personal_detail").customPUT(a):b.all("kyc").all("personal_detail").customPOST(a)},this.getPersonaDetails=function(){return b.all("kyc").one("personal_detail").get()},this.getEditablePersonalDetails=function(){return b.all("kyc").one("personal_detail").one("editable").customGET()},this.deleteDevice=function(a){return b.one("device").one(a+"").customDELETE()},this.blockDevice=function(a){return b.one("device").one(a+"").one("block").customPUT()},this.unblockDevice=function(a){return b.one("device").one(a+"").one("activate").customPUT()},this.setNeverSeeThisAgain=function(a){return b.one("kyc").one("skip",a).put({never_see:!0})},this.skipInitialRequirement=function(a){return b.one("kyc").one("skip",a).put({never_see:!1})},this.getImagesPath=function(){return a.one("auth").one("kyc").one("document").one("uploads").getList()},this.submitForVerification=function(b){return a.one("auth").one("kyc").one("status").one("submit").one(b).customPUT()},this.getKyc=function(){return a.one("auth").one("kyc").get()},this.getOccupation=function(){return a.all("occupation").getList()}}])}(),function(){angular.module("esewaCustomerApp").service("AddressService",["Restangular",function(a){var b=a.all("address");this.getZones=function(){return b.one("zone").get()},this.getDistrict=function(a){return b.all("zone").one(a+"").one("district").get()},this.getVdcs=function(a){return b.all("district").one(a+"").one("vdc").get()}}])}();